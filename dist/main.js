(()=>{"use strict";const e=async e=>{const t=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${e}&appid=a0c9839361f301aa4ff8bb089dde2d79`);return 200===t.status?await t.json():Promise.reject(t)},t=async()=>{const e=Math.floor(508061*Math.random())-1,t=await fetch(`https://wft-geo-db.p.rapidapi.com/v1/geo/cities?limit=1&includeDeleted=NONE&offset=${e}`,{method:"GET",headers:{"X-RapidAPI-Key":"807ea18ec2msh3a2175b27cf041dp170feajsnf745f5536e94","X-RapidAPI-Host":"wft-geo-db.p.rapidapi.com"}});return 200===t.status?await t.json():Promise.reject(t)},r=(()=>{const e=e=>e.main.temp;return{getTemperatureFahrenheit:t=>{const r=9*(e(t)-273.15)/5+32;return Math.round(100*r)/100},getTemperatureCelsius:t=>{const r=e(t)-273.15;return Math.round(100*r)/100},getWeatherMain:e=>e.weather[0].main,getWeatherDescription:e=>e.weather[0].description,getWeatherIconCode:e=>e.weather[0].icon,getCityName:e=>e.name,getRandomCityName:e=>e.data[0].city}})(),o=(()=>{let e=!1;const t=e=>{e.classList.toggle("not-displayed")},o=e=>{document.querySelector(".loading-message").textContent=e},a=e=>new Promise((t=>setTimeout(t,e))),n=async()=>{const t=document.querySelector("#loading-indicator");for(e=!e;e;){if(await a(1e3),Array.from(t.classList).includes("not-displayed")){o("Loading...");break}if(o("Loading."),await a(1e3),Array.from(t.classList).includes("not-displayed")){o("Loading...");break}o("Loading.."),await a(1e3),o("Loading...")}};return{updateDisplayedWeather:e=>{(e=>{const t=r.getWeatherIconCode(e);document.querySelector(".weather-icon").src=`http://openweathermap.org/img/wn/${t}.png`})(e),(e=>{const t=r.getWeatherMain(e);document.querySelector(".weather-main").textContent=t})(e),(e=>{const t=r.getWeatherDescription(e);document.querySelector(".weather-description").textContent=t})(e),(e=>{const t=r.getTemperatureFahrenheit(e);document.querySelector(".temp-f").textContent=`${t}째F`})(e),(e=>{const t=r.getTemperatureCelsius(e);document.querySelector(".temp-c").textContent=`${t}째C`})(e),(e=>{const t=r.getCityName(e);document.querySelector(".city-name").textContent=t})(e),document.querySelector("#city").value=""},addPlaceholderValues:()=>{const e=document.querySelector(".weather-icon"),t=document.querySelector(".weather-main"),r=document.querySelector(".weather-description"),o=document.querySelector(".temp-f"),a=document.querySelector(".temp-c"),n=document.querySelector(".city-name");e.src="../dist/mickey.png",t.textContent="The sun might or might not be visible",r.textContent="hopefully the sky is still blue",o.textContent="Larger number째F",a.textContent="Smaller number째C",n.textContent="Disneyland"},changeErrorMessage:e=>{document.querySelector(".error-message").textContent=e},toggleElementDisplay:t,toggleLoadingInProgress:()=>{const e=document.querySelector("#loading-indicator");Array.from(document.querySelectorAll(".submission-element")).forEach((e=>{!1===e.disabled?e.disabled=!0:e.disabled=!1})),t(e),n()},toggleLoadingMessageCycle:n}})(),a=(()=>{const a=async()=>{const t=document.querySelector("#city").value;if(""!==t)try{const r=await e(t);o.updateDisplayedWeather(r)}catch(e){404===e.status?o.changeErrorMessage("Uh oh, looks like something went wrong! Check your spelling or try a different city!"):429===e.status?o.changeErrorMessage("Whoa, slow down there partner! Save some weather data for the rest of us!"):500===e.status&&o.changeErrorMessage("Something out of our control is broken. Try again later!"),console.error(Error(e.statusText))}o.toggleLoadingInProgress()},n=async()=>{let a,s;try{const n=await t();a=r.getRandomCityName(n),s=await e(a),o.updateDisplayedWeather(s),o.toggleLoadingInProgress()}catch(e){404===e.status&&void 0===a?o.changeErrorMessage("Hmm, it seems like we're running into some trouble. Try again!"):404===e.status&&void 0===s||429===e.status?setTimeout(n,1500):500===e.status&&o.changeErrorMessage("Something out of our control is broken. Try again later!"),console.error(Error(`${e.status} ${e.statusText}`))}};return{addUserInputListeners:()=>{document.querySelector(".search-button").addEventListener("click",(()=>{o.toggleLoadingInProgress(),a()})),document.querySelector("#city").addEventListener("keydown",(e=>{"Enter"===e.key&&(o.toggleLoadingInProgress(),a())})),document.querySelector(".random-button").addEventListener("click",(()=>{o.toggleLoadingInProgress(),n()})),(()=>{const e=Array.from(document.querySelectorAll(".temp-button"));e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{o.toggleElementDisplay(e)}))}))}))})()}}})();!async function(){try{const t=await e("Hell");o.updateDisplayedWeather(t)}catch(e){o.addPlaceholderValues(),console.error(Error(`${e.status} ${e.statusText}. If you can see this, that means there was an issue with the OpenWeatherMap API!`))}}(),a.addUserInputListeners()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDekRtQixFQUFZbEIsU0FBU21CLElBQ25CQSxFQUFPSixpQkFBaUIsU0FBUyxLQUMvQkcsRUFBWWxCLFNBQVNtQixJQUNuQmhFLEVBQWdCRSxxQkFBcUI4RCxFQUFPLEdBQzVDLEdBQ0YsR0FDRixFQU1GQyxFQUErQixFQUdsQyxFQTlGaUIsSUNtQmxCLGlCQUNFLElBQ0UsTUFBTWhHLFFBQWlCSCxFQUEwQixRQUNqRGtDLEVBQWdCbUIsdUJBQXVCbEQsRUFRekMsQ0FQRSxNQUFPaUYsR0FDUGxELEVBQWdCbUMsdUJBQ2hCZ0IsUUFBUUQsTUFDTkUsTUFDRSxHQUFHRixFQUFNL0UsVUFBVStFLEVBQU1HLCtGQUcvQixDQUNELENBWkQsR0FhQU4sRUFBVVksdUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vZGluLXdlYXRoZXItYXBwLy4vc3JjL0FQSV9yZXF1ZXN0X21vZHVsZS5qcyIsIndlYnBhY2s6Ly9vZGluLXdlYXRoZXItYXBwLy4vc3JjL2ZpbHRlcl9kYXRhX21vZHVsZS5qcyIsIndlYnBhY2s6Ly9vZGluLXdlYXRoZXItYXBwLy4vc3JjL0RPTV9tYW5pcHVsYXRpb25fbW9kdWxlLmpzIiwid2VicGFjazovL29kaW4td2VhdGhlci1hcHAvLi9zcmMvdXNlcl9pbnB1dF9tb2R1bGUuanMiLCJ3ZWJwYWNrOi8vb2Rpbi13ZWF0aGVyLWFwcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBBUElSZXF1ZXN0ID0gKCgpID0+IHtcbiAgY29uc3QgQVBJS0VZID0gXCJhMGM5ODM5MzYxZjMwMWFhNGZmOGJiMDg5ZGRlMmQ3OVwiO1xuICBjb25zdCBnZXRDaXR5V2VhdGhlciA9IGFzeW5jIChjaXR5KSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIGBodHRwczovL2FwaS5vcGVud2VhdGhlcm1hcC5vcmcvZGF0YS8yLjUvd2VhdGhlcj9xPSR7Y2l0eX0mYXBwaWQ9JHtBUElLRVl9YFxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBjb25zdCBwYXJzZWRPYmplY3QgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4gcGFyc2VkT2JqZWN0O1xuICAgIH1cbiAgICAvLyBuZXR3b3JrIGVycm9yLCBjaGFuZ2UgRE9NIHRvIGhhdmUgZXJyb3IgbWVzc2FnZVxuICAgIC8vIGFjdHVhbGx5IHRoaXMgbWlnaHQgbWFrZSBtb3JlIHNlbnNlIHRvIGdvIGluIHVzZXJJbnB1dCgpXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlKTtcbiAgfTtcbiAgY29uc3QgZ2V0UmFuZG9tQ2l0eSA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBDSVRZQ09VTlQgPSA1MDgwNjE7XG4gICAgY29uc3QgcmFuZG9tQ2l0eUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogQ0lUWUNPVU5UKSAtIDE7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJYLVJhcGlkQVBJLUtleVwiOiBcIjgwN2VhMThlYzJtc2gzYTIxNzViMjdjZjA0MWRwMTcwZmVhanNuZjc0NWY1NTM2ZTk0XCIsXG4gICAgICAgIFwiWC1SYXBpZEFQSS1Ib3N0XCI6IFwid2Z0LWdlby1kYi5wLnJhcGlkYXBpLmNvbVwiLFxuICAgICAgfSxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICBgaHR0cHM6Ly93ZnQtZ2VvLWRiLnAucmFwaWRhcGkuY29tL3YxL2dlby9jaXRpZXM/bGltaXQ9MSZpbmNsdWRlRGVsZXRlZD1OT05FJm9mZnNldD0ke3JhbmRvbUNpdHlJbmRleH1gLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBjb25zdCBwYXJzZWRPYmplY3QgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4gcGFyc2VkT2JqZWN0O1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzcG9uc2UpO1xuICB9O1xuICByZXR1cm4geyBnZXRDaXR5V2VhdGhlciwgZ2V0UmFuZG9tQ2l0eSB9O1xufSkoKTtcblxuZXhwb3J0IHsgQVBJUmVxdWVzdCB9O1xuIiwiY29uc3QgZmlsdGVyRGF0YSA9ICgoKSA9PiB7XG4gIGNvbnN0IGdldFRlbXBlcmF0dXJlID0gKGRhdGEpID0+IGRhdGEubWFpbi50ZW1wO1xuICBjb25zdCBnZXRUZW1wZXJhdHVyZUZhaHJlbmhlaXQgPSAoZGF0YSkgPT4ge1xuICAgIGNvbnN0IGtlbHZpbiA9IGdldFRlbXBlcmF0dXJlKGRhdGEpO1xuICAgIGNvbnN0IGZhaHJlbmhlaXQgPSAoKGtlbHZpbiAtIDI3My4xNSkgKiA5KSAvIDUgKyAzMjtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChmYWhyZW5oZWl0ICogMTAwKSAvIDEwMDtcbiAgfTtcbiAgY29uc3QgZ2V0VGVtcGVyYXR1cmVDZWxzaXVzID0gKGRhdGEpID0+IHtcbiAgICBjb25zdCBrZWx2aW4gPSBnZXRUZW1wZXJhdHVyZShkYXRhKTtcbiAgICBjb25zdCBjZWxzaXVzID0ga2VsdmluIC0gMjczLjE1O1xuICAgIHJldHVybiBNYXRoLnJvdW5kKGNlbHNpdXMgKiAxMDApIC8gMTAwO1xuICB9O1xuICBjb25zdCBnZXRXZWF0aGVyTWFpbiA9IChkYXRhKSA9PiBkYXRhLndlYXRoZXJbMF0ubWFpbjtcbiAgY29uc3QgZ2V0V2VhdGhlckRlc2NyaXB0aW9uID0gKGRhdGEpID0+IGRhdGEud2VhdGhlclswXS5kZXNjcmlwdGlvbjtcbiAgY29uc3QgZ2V0V2VhdGhlckljb25Db2RlID0gKGRhdGEpID0+IGRhdGEud2VhdGhlclswXS5pY29uO1xuICBjb25zdCBnZXRDaXR5TmFtZSA9IChkYXRhKSA9PiBkYXRhLm5hbWU7XG4gIGNvbnN0IGdldFJhbmRvbUNpdHlOYW1lID0gKGRhdGEpID0+IGRhdGEuZGF0YVswXS5jaXR5O1xuICByZXR1cm4ge1xuICAgIGdldFRlbXBlcmF0dXJlRmFocmVuaGVpdCxcbiAgICBnZXRUZW1wZXJhdHVyZUNlbHNpdXMsXG4gICAgZ2V0V2VhdGhlck1haW4sXG4gICAgZ2V0V2VhdGhlckRlc2NyaXB0aW9uLFxuICAgIGdldFdlYXRoZXJJY29uQ29kZSxcbiAgICBnZXRDaXR5TmFtZSxcbiAgICBnZXRSYW5kb21DaXR5TmFtZSxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IGZpbHRlckRhdGEgfTtcbiIsImltcG9ydCB7IGZpbHRlckRhdGEgfSBmcm9tIFwiLi9maWx0ZXJfZGF0YV9tb2R1bGVcIjtcblxuY29uc3QgRE9NTWFuaXB1bGF0aW9uID0gKCgpID0+IHtcbiAgbGV0IHRpbWVyID0gZmFsc2U7XG4gIGNvbnN0IGFkZFdlYXRoZXJJY29uID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3Qgd2VhdGhlckljb24gPSBmaWx0ZXJEYXRhLmdldFdlYXRoZXJJY29uQ29kZSh3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3Qgd2VhdGhlckljb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWF0aGVyLWljb25cIik7XG4gICAgd2VhdGhlckljb25FbGVtZW50LnNyYyA9IGBodHRwOi8vb3BlbndlYXRoZXJtYXAub3JnL2ltZy93bi8ke3dlYXRoZXJJY29ufS5wbmdgO1xuICB9O1xuICBjb25zdCBhZGRXZWF0aGVyTWFpbiA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IHdlYXRoZXJNYWluID0gZmlsdGVyRGF0YS5nZXRXZWF0aGVyTWFpbih3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3Qgd2VhdGhlck1haW5FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWF0aGVyLW1haW5cIik7XG4gICAgd2VhdGhlck1haW5FbGVtZW50LnRleHRDb250ZW50ID0gd2VhdGhlck1haW47XG4gIH07XG4gIGNvbnN0IGFkZFdlYXRoZXJEZXNjcmlwdGlvbiA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IHdlYXRoZXJEZXNjcmlwdGlvbiA9IGZpbHRlckRhdGEuZ2V0V2VhdGhlckRlc2NyaXB0aW9uKHdlYXRoZXJEYXRhKTtcbiAgICBjb25zdCB3ZWF0aGVyRGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLndlYXRoZXItZGVzY3JpcHRpb25cIlxuICAgICk7XG4gICAgd2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IHdlYXRoZXJEZXNjcmlwdGlvbjtcbiAgfTtcbiAgY29uc3QgYWRkVGVtcGVyYXR1cmVGYWhyZW5oZWl0ID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3QgdGVtcEYgPSBmaWx0ZXJEYXRhLmdldFRlbXBlcmF0dXJlRmFocmVuaGVpdCh3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3QgdGVtcEZFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZW1wLWZcIik7XG4gICAgdGVtcEZFbGVtZW50LnRleHRDb250ZW50ID0gYCR7dGVtcEZ9wrBGYDtcbiAgfTtcbiAgY29uc3QgYWRkVGVtcGVyYXR1cmVDZWxzaXVzID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3QgdGVtcEMgPSBmaWx0ZXJEYXRhLmdldFRlbXBlcmF0dXJlQ2Vsc2l1cyh3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3QgdGVtcENFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZW1wLWNcIik7XG4gICAgdGVtcENFbGVtZW50LnRleHRDb250ZW50ID0gYCR7dGVtcEN9wrBDYDtcbiAgfTtcbiAgY29uc3QgYWRkQ2l0eU5hbWUgPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBjb25zdCBjaXR5TmFtZSA9IGZpbHRlckRhdGEuZ2V0Q2l0eU5hbWUod2VhdGhlckRhdGEpO1xuICAgIGNvbnN0IGNpdHlOYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2l0eS1uYW1lXCIpO1xuICAgIGNpdHlOYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGNpdHlOYW1lO1xuICB9O1xuICBjb25zdCByZXNldElucHV0VmFsdWUgPSAoKSA9PiB7XG4gICAgY29uc3QgY2l0eUlucHV0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2l0eVwiKTtcbiAgICBjaXR5SW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcbiAgfTtcbiAgY29uc3QgYWRkUGxhY2Vob2xkZXJWYWx1ZXMgPSAoKSA9PiB7XG4gICAgY29uc3Qgd2VhdGhlckljb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWF0aGVyLWljb25cIik7XG4gICAgY29uc3Qgd2VhdGhlck1haW5FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWF0aGVyLW1haW5cIik7XG4gICAgY29uc3Qgd2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi53ZWF0aGVyLWRlc2NyaXB0aW9uXCJcbiAgICApO1xuICAgIGNvbnN0IHRlbXBGRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVtcC1mXCIpO1xuICAgIGNvbnN0IHRlbXBDRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVtcC1jXCIpO1xuICAgIGNvbnN0IGNpdHlOYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2l0eS1uYW1lXCIpO1xuICAgIHdlYXRoZXJJY29uRWxlbWVudC5zcmMgPSBcIi4uL2Rpc3QvbWlja2V5LnBuZ1wiO1xuICAgIHdlYXRoZXJNYWluRWxlbWVudC50ZXh0Q29udGVudCA9IFwiVGhlIHN1biBtaWdodCBvciBtaWdodCBub3QgYmUgdmlzaWJsZVwiO1xuICAgIHdlYXRoZXJEZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBcImhvcGVmdWxseSB0aGUgc2t5IGlzIHN0aWxsIGJsdWVcIjtcbiAgICB0ZW1wRkVsZW1lbnQudGV4dENvbnRlbnQgPSBcIkxhcmdlciBudW1iZXLCsEZcIjtcbiAgICB0ZW1wQ0VsZW1lbnQudGV4dENvbnRlbnQgPSBcIlNtYWxsZXIgbnVtYmVywrBDXCI7XG4gICAgY2l0eU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gXCJEaXNuZXlsYW5kXCI7XG4gIH07XG4gIGNvbnN0IGNoYW5nZUVycm9yTWVzc2FnZSA9IChtZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZXJyb3ItbWVzc2FnZVwiKTtcbiAgICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gbWVzc2FnZTtcbiAgfTtcbiAgY29uc3QgdG9nZ2xlU3VibWlzc2lvbkVsZW1lbnRzRW5hYmxlZCA9ICgpID0+IHtcbiAgICBjb25zdCBzdWJtaXNzaW9uRWxlbWVudHMgPSBBcnJheS5mcm9tKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zdWJtaXNzaW9uLWVsZW1lbnRcIilcbiAgICApO1xuICAgIHN1Ym1pc3Npb25FbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBpZiAoZWxlbWVudC5kaXNhYmxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgZWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IHRvZ2dsZUVsZW1lbnREaXNwbGF5ID0gKGVsZW1lbnQpID0+IHtcbiAgICBlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJub3QtZGlzcGxheWVkXCIpO1xuICB9O1xuICBjb25zdCBjaGFuZ2VMb2FkaW5nTWVzc2FnZSA9IChtZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgbG9hZGluZ01lc3NhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmxvYWRpbmctbWVzc2FnZVwiKTtcbiAgICBsb2FkaW5nTWVzc2FnZS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gIH07XG4gIGNvbnN0IHdhaXRUaW1lciA9IChkdXJhdGlvbikgPT5cbiAgICBuZXcgUHJvbWlzZSgocmVzcG9uc2UpID0+IHNldFRpbWVvdXQocmVzcG9uc2UsIGR1cmF0aW9uKSk7XG4gIGNvbnN0IHRvZ2dsZUxvYWRpbmdNZXNzYWdlQ3ljbGUgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbG9hZGluZ0luZGljYXRvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gICAgdGltZXIgPyAodGltZXIgPSBmYWxzZSkgOiAodGltZXIgPSB0cnVlKTtcbiAgICB3aGlsZSAodGltZXIpIHtcbiAgICAgIGF3YWl0IHdhaXRUaW1lcigxMDAwKTtcbiAgICAgIGlmIChBcnJheS5mcm9tKGxvYWRpbmdJbmRpY2F0b3IuY2xhc3NMaXN0KS5pbmNsdWRlcyhcIm5vdC1kaXNwbGF5ZWRcIikpIHtcbiAgICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoXCJMb2FkaW5nLi4uXCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNoYW5nZUxvYWRpbmdNZXNzYWdlKFwiTG9hZGluZy5cIik7XG4gICAgICBhd2FpdCB3YWl0VGltZXIoMTAwMCk7XG4gICAgICBpZiAoQXJyYXkuZnJvbShsb2FkaW5nSW5kaWNhdG9yLmNsYXNzTGlzdCkuaW5jbHVkZXMoXCJub3QtZGlzcGxheWVkXCIpKSB7XG4gICAgICAgIGNoYW5nZUxvYWRpbmdNZXNzYWdlKFwiTG9hZGluZy4uLlwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjaGFuZ2VMb2FkaW5nTWVzc2FnZShcIkxvYWRpbmcuLlwiKTtcbiAgICAgIGF3YWl0IHdhaXRUaW1lcigxMDAwKTtcbiAgICAgIGNoYW5nZUxvYWRpbmdNZXNzYWdlKFwiTG9hZGluZy4uLlwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHRvZ2dsZUxvYWRpbmdJblByb2dyZXNzID0gKCkgPT4ge1xuICAgIGNvbnN0IGxvYWRpbmdJbmRpY2F0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvYWRpbmctaW5kaWNhdG9yXCIpO1xuICAgIHRvZ2dsZVN1Ym1pc3Npb25FbGVtZW50c0VuYWJsZWQoKTtcbiAgICB0b2dnbGVFbGVtZW50RGlzcGxheShsb2FkaW5nSW5kaWNhdG9yKTtcbiAgICB0b2dnbGVMb2FkaW5nTWVzc2FnZUN5Y2xlKCk7XG4gIH07XG4gIGNvbnN0IHVwZGF0ZURpc3BsYXllZFdlYXRoZXIgPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBhZGRXZWF0aGVySWNvbih3ZWF0aGVyRGF0YSk7XG4gICAgYWRkV2VhdGhlck1haW4od2VhdGhlckRhdGEpO1xuICAgIGFkZFdlYXRoZXJEZXNjcmlwdGlvbih3ZWF0aGVyRGF0YSk7XG4gICAgYWRkVGVtcGVyYXR1cmVGYWhyZW5oZWl0KHdlYXRoZXJEYXRhKTtcbiAgICBhZGRUZW1wZXJhdHVyZUNlbHNpdXMod2VhdGhlckRhdGEpO1xuICAgIGFkZENpdHlOYW1lKHdlYXRoZXJEYXRhKTtcbiAgICByZXNldElucHV0VmFsdWUoKTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICB1cGRhdGVEaXNwbGF5ZWRXZWF0aGVyLFxuICAgIGFkZFBsYWNlaG9sZGVyVmFsdWVzLFxuICAgIGNoYW5nZUVycm9yTWVzc2FnZSxcbiAgICB0b2dnbGVFbGVtZW50RGlzcGxheSxcbiAgICB0b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyxcbiAgICB0b2dnbGVMb2FkaW5nTWVzc2FnZUN5Y2xlLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IHsgRE9NTWFuaXB1bGF0aW9uIH07XG4iLCJpbXBvcnQgeyBBUElSZXF1ZXN0IH0gZnJvbSBcIi4vQVBJX3JlcXVlc3RfbW9kdWxlXCI7XG5pbXBvcnQgeyBmaWx0ZXJEYXRhIH0gZnJvbSBcIi4vZmlsdGVyX2RhdGFfbW9kdWxlXCI7XG5pbXBvcnQgeyBET01NYW5pcHVsYXRpb24gfSBmcm9tIFwiLi9ET01fbWFuaXB1bGF0aW9uX21vZHVsZVwiO1xuXG5jb25zdCB1c2VySW5wdXQgPSAoKCkgPT4ge1xuICBjb25zdCBzdWJtaXRVc2VySW5wdXQgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgY2l0eUlucHV0VmFsdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NpdHlcIikudmFsdWU7XG4gICAgaWYgKGNpdHlJbnB1dFZhbHVlICE9PSBcIlwiKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEFQSVJlcXVlc3QuZ2V0Q2l0eVdlYXRoZXIoY2l0eUlucHV0VmFsdWUpO1xuICAgICAgICBET01NYW5pcHVsYXRpb24udXBkYXRlRGlzcGxheWVkV2VhdGhlcihyZXNwb25zZSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgICAvLyBPcGVuV2VhdGhlck1hcCBBUEkgY2FuJ3QgZmluZCB0aGUgY2l0eSBkdWUgdG8gbWlzc3BlbGxpbmcgb3IgbGFjayBvZiBkYXRhXG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICAgIFwiVWggb2gsIGxvb2tzIGxpa2Ugc29tZXRoaW5nIHdlbnQgd3JvbmchIENoZWNrIHlvdXIgc3BlbGxpbmcgb3IgdHJ5IGEgZGlmZmVyZW50IGNpdHkhXCJcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDI5KSB7XG4gICAgICAgICAgLy8gT3BlbldlYXRoZXJNYXAgQVBJIHJhdGUgbGltaXRcbiAgICAgICAgICBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFxuICAgICAgICAgICAgXCJXaG9hLCBzbG93IGRvd24gdGhlcmUgcGFydG5lciEgU2F2ZSBzb21lIHdlYXRoZXIgZGF0YSBmb3IgdGhlIHJlc3Qgb2YgdXMhXCJcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNTAwKSB7XG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICAgIFwiU29tZXRoaW5nIG91dCBvZiBvdXIgY29udHJvbCBpcyBicm9rZW4uIFRyeSBhZ2FpbiBsYXRlciFcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5lcnJvcihFcnJvcihlcnJvci5zdGF0dXNUZXh0KSk7XG4gICAgICB9XG4gICAgfVxuICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcygpO1xuICB9O1xuICBjb25zdCBzdWJtaXRSYW5kb21JbnB1dCA9IGFzeW5jICgpID0+IHtcbiAgICBsZXQgcmFuZG9tQ2l0eU5hbWU7XG4gICAgbGV0IHdlYXRoZXJSZXNwb25zZTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2l0eVJlc3BvbnNlID0gYXdhaXQgQVBJUmVxdWVzdC5nZXRSYW5kb21DaXR5KCk7XG4gICAgICByYW5kb21DaXR5TmFtZSA9IGZpbHRlckRhdGEuZ2V0UmFuZG9tQ2l0eU5hbWUoY2l0eVJlc3BvbnNlKTtcbiAgICAgIHdlYXRoZXJSZXNwb25zZSA9IGF3YWl0IEFQSVJlcXVlc3QuZ2V0Q2l0eVdlYXRoZXIocmFuZG9tQ2l0eU5hbWUpO1xuICAgICAgRE9NTWFuaXB1bGF0aW9uLnVwZGF0ZURpc3BsYXllZFdlYXRoZXIod2VhdGhlclJlc3BvbnNlKTtcbiAgICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcygpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDQgJiYgcmFuZG9tQ2l0eU5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBHZW9EQiBBUEkgZXJyb3JcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICBcIkhtbSwgaXQgc2VlbXMgbGlrZSB3ZSdyZSBydW5uaW5nIGludG8gc29tZSB0cm91YmxlLiBUcnkgYWdhaW4hXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIChlcnJvci5zdGF0dXMgPT09IDQwNCAmJiB3ZWF0aGVyUmVzcG9uc2UgPT09IHVuZGVmaW5lZCkgfHxcbiAgICAgICAgZXJyb3Iuc3RhdHVzID09PSA0MjlcbiAgICAgICkge1xuICAgICAgICAvLyBHZW9EQiBnYXZlIGEgY2l0eSB0aGF0IGhhcyBubyBkYXRhIGluIE9wZW5XZWF0aGVyTWFwIEFQSVxuICAgICAgICBzZXRUaW1lb3V0KHN1Ym1pdFJhbmRvbUlucHV0LCAxNTAwKTtcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3Iuc3RhdHVzID09PSA1MDApIHtcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICBcIlNvbWV0aGluZyBvdXQgb2Ygb3VyIGNvbnRyb2wgaXMgYnJva2VuLiBUcnkgYWdhaW4gbGF0ZXIhXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUuZXJyb3IoRXJyb3IoYCR7ZXJyb3Iuc3RhdHVzfSAke2Vycm9yLnN0YXR1c1RleHR9YCkpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYWRkU2VhcmNoQnV0dG9uTGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2VhcmNoQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZWFyY2gtYnV0dG9uXCIpO1xuICAgIHNlYXJjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKCksIHN1Ym1pdFVzZXJJbnB1dCgpO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGRJbnB1dEVsZW1lbnRMaXN0ZW5lciA9ICgpID0+IHtcbiAgICBjb25zdCBjaXR5SW5wdXRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjaXR5XCIpO1xuICAgIGNpdHlJbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKCksIHN1Ym1pdFVzZXJJbnB1dCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGRSYW5kb21CdXR0b25MaXN0ZW5lciA9ICgpID0+IHtcbiAgICBjb25zdCByYW5kb21CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhbmRvbS1idXR0b25cIik7XG4gICAgcmFuZG9tQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBET01NYW5pcHVsYXRpb24udG9nZ2xlTG9hZGluZ0luUHJvZ3Jlc3MoKSwgc3VibWl0UmFuZG9tSW5wdXQoKTtcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgYWRkVGVtcGVyYXR1cmVCdXR0b25MaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgY29uc3QgdGVtcEJ1dHRvbnMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGVtcC1idXR0b25cIikpO1xuICAgIHRlbXBCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRlbXBCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVFbGVtZW50RGlzcGxheShidXR0b24pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGRVc2VySW5wdXRMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgYWRkU2VhcmNoQnV0dG9uTGlzdGVuZXIoKTtcbiAgICBhZGRJbnB1dEVsZW1lbnRMaXN0ZW5lcigpO1xuICAgIGFkZFJhbmRvbUJ1dHRvbkxpc3RlbmVyKCk7XG4gICAgYWRkVGVtcGVyYXR1cmVCdXR0b25MaXN0ZW5lcnMoKTtcbiAgfTtcbiAgcmV0dXJuIHsgYWRkVXNlcklucHV0TGlzdGVuZXJzIH07XG59KSgpO1xuXG5leHBvcnQgeyB1c2VySW5wdXQgfTtcbiIsImltcG9ydCB7IEFQSVJlcXVlc3QgfSBmcm9tIFwiLi9BUElfcmVxdWVzdF9tb2R1bGVcIjtcbmltcG9ydCB7IGZpbHRlckRhdGEgfSBmcm9tIFwiLi9maWx0ZXJfZGF0YV9tb2R1bGVcIjtcbmltcG9ydCB7IHVzZXJJbnB1dCB9IGZyb20gXCIuL3VzZXJfaW5wdXRfbW9kdWxlXCI7XG5pbXBvcnQgeyBET01NYW5pcHVsYXRpb24gfSBmcm9tIFwiLi9ET01fbWFuaXB1bGF0aW9uX21vZHVsZVwiO1xuXG4vLyBBUElSZXF1ZXN0LmdldENpdHlXZWF0aGVyKFwiU2FuIEZyYW5jaXNjb1wiKVxuLy8gICAudGhlbigocmVzcG9uc2UpID0+IHtcbi8vICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4vLyAgICAgY29uc29sZS5sb2cocmVzcG9uc2Uud2VhdGhlclswXS5pY29uKTtcbi8vICAgICBjb25zdCBpY29uID0gZmlsdGVyRGF0YS5nZXRXZWF0aGVySWNvbkNvZGUocmVzcG9uc2UpO1xuLy8gICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4vLyAgICAgaW1nLnNyYyA9IGBodHRwOi8vb3BlbndlYXRoZXJtYXAub3JnL2ltZy93bi8ke2ljb259LnBuZ2A7XG4vLyAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImRpdlwiKTtcbi8vICAgICBkaXYuYXBwZW5kQ2hpbGQoaW1nKTtcbi8vICAgICBjb25zb2xlLmxvZyhmaWx0ZXJEYXRhLmdldFdlYXRoZXJNYWluKHJlc3BvbnNlKSk7XG4vLyAgICAgY29uc29sZS5sb2coZmlsdGVyRGF0YS5nZXRXZWF0aGVyRGVzY3JpcHRpb24ocmVzcG9uc2UpKTtcbi8vICAgICBjb25zb2xlLmxvZyhmaWx0ZXJEYXRhLmdldFRlbXBlcmF0dXJlKHJlc3BvbnNlKSk7XG4vLyAgICAgY29uc29sZS5sb2coZmlsdGVyRGF0YS5nZXRUZW1wZXJhdHVyZUZhaHJlbmhlaXQocmVzcG9uc2UpKTtcbi8vICAgICBjb25zb2xlLmxvZyhmaWx0ZXJEYXRhLmdldFRlbXBlcmF0dXJlQ2Vsc2l1cyhyZXNwb25zZSkpO1xuLy8gICB9KVxuLy8gICAudGhlbigocmVzcG9uc2UpID0+IHtcbi8vICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4vLyAgIH0pO1xuKGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVQYWdlKCkge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQVBJUmVxdWVzdC5nZXRDaXR5V2VhdGhlcihcIkhlbGxcIik7XG4gICAgRE9NTWFuaXB1bGF0aW9uLnVwZGF0ZURpc3BsYXllZFdlYXRoZXIocmVzcG9uc2UpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIERPTU1hbmlwdWxhdGlvbi5hZGRQbGFjZWhvbGRlclZhbHVlcygpO1xuICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICBFcnJvcihcbiAgICAgICAgYCR7ZXJyb3Iuc3RhdHVzfSAke2Vycm9yLnN0YXR1c1RleHR9LiBJZiB5b3UgY2FuIHNlZSB0aGlzLCB0aGF0IG1lYW5zIHRoZXJlIHdhcyBhbiBpc3N1ZSB3aXRoIHRoZSBPcGVuV2VhdGhlck1hcCBBUEkhYFxuICAgICAgKVxuICAgICk7XG4gIH1cbn0pKCk7XG51c2VySW5wdXQuYWRkVXNlcklucHV0TGlzdGVuZXJzKCk7XG4iXSwibmFtZXMiOlsiQVBJUmVxdWVzdCIsImFzeW5jIiwiY2l0eSIsInJlc3BvbnNlIiwiZmV0Y2giLCJzdGF0dXMiLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInJhbmRvbUNpdHlJbmRleCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm1ldGhvZCIsImhlYWRlcnMiLCJmaWx0ZXJEYXRhIiwiZ2V0VGVtcGVyYXR1cmUiLCJkYXRhIiwibWFpbiIsInRlbXAiLCJnZXRUZW1wZXJhdHVyZUZhaHJlbmhlaXQiLCJmYWhyZW5oZWl0Iiwicm91bmQiLCJnZXRUZW1wZXJhdHVyZUNlbHNpdXMiLCJjZWxzaXVzIiwiZ2V0V2VhdGhlck1haW4iLCJ3ZWF0aGVyIiwiZ2V0V2VhdGhlckRlc2NyaXB0aW9uIiwiZGVzY3JpcHRpb24iLCJnZXRXZWF0aGVySWNvbkNvZGUiLCJpY29uIiwiZ2V0Q2l0eU5hbWUiLCJuYW1lIiwiZ2V0UmFuZG9tQ2l0eU5hbWUiLCJET01NYW5pcHVsYXRpb24iLCJ0aW1lciIsInRvZ2dsZUVsZW1lbnREaXNwbGF5IiwiZWxlbWVudCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImNoYW5nZUxvYWRpbmdNZXNzYWdlIiwibWVzc2FnZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRleHRDb250ZW50Iiwid2FpdFRpbWVyIiwiZHVyYXRpb24iLCJzZXRUaW1lb3V0IiwidG9nZ2xlTG9hZGluZ01lc3NhZ2VDeWNsZSIsImxvYWRpbmdJbmRpY2F0b3IiLCJBcnJheSIsImZyb20iLCJpbmNsdWRlcyIsInVwZGF0ZURpc3BsYXllZFdlYXRoZXIiLCJ3ZWF0aGVyRGF0YSIsIndlYXRoZXJJY29uIiwic3JjIiwiYWRkV2VhdGhlckljb24iLCJ3ZWF0aGVyTWFpbiIsImFkZFdlYXRoZXJNYWluIiwid2VhdGhlckRlc2NyaXB0aW9uIiwiYWRkV2VhdGhlckRlc2NyaXB0aW9uIiwidGVtcEYiLCJhZGRUZW1wZXJhdHVyZUZhaHJlbmhlaXQiLCJ0ZW1wQyIsImFkZFRlbXBlcmF0dXJlQ2Vsc2l1cyIsImNpdHlOYW1lIiwiYWRkQ2l0eU5hbWUiLCJ2YWx1ZSIsImFkZFBsYWNlaG9sZGVyVmFsdWVzIiwid2VhdGhlckljb25FbGVtZW50Iiwid2VhdGhlck1haW5FbGVtZW50Iiwid2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudCIsInRlbXBGRWxlbWVudCIsInRlbXBDRWxlbWVudCIsImNpdHlOYW1lRWxlbWVudCIsImNoYW5nZUVycm9yTWVzc2FnZSIsInRvZ2dsZUxvYWRpbmdJblByb2dyZXNzIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJkaXNhYmxlZCIsInVzZXJJbnB1dCIsInN1Ym1pdFVzZXJJbnB1dCIsImNpdHlJbnB1dFZhbHVlIiwiZXJyb3IiLCJjb25zb2xlIiwiRXJyb3IiLCJzdGF0dXNUZXh0Iiwic3VibWl0UmFuZG9tSW5wdXQiLCJyYW5kb21DaXR5TmFtZSIsIndlYXRoZXJSZXNwb25zZSIsImNpdHlSZXNwb25zZSIsInVuZGVmaW5lZCIsImFkZFVzZXJJbnB1dExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleSIsInRlbXBCdXR0b25zIiwiYnV0dG9uIiwiYWRkVGVtcGVyYXR1cmVCdXR0b25MaXN0ZW5lcnMiXSwic291cmNlUm9vdCI6IiJ9