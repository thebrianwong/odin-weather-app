(()=>{"use strict";const e=async e=>{const t=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${e}&appid=a0c9839361f301aa4ff8bb089dde2d79`);return 200===t.status?await t.json():Promise.reject(t)},t=async()=>{const e=Math.floor(508061*Math.random())-1,t=await fetch(`https://wft-geo-db.p.rapidapi.com/v1/geo/cities?limit=1&includeDeleted=NONE&offset=${e}`,{method:"GET",headers:{"X-RapidAPI-Key":"807ea18ec2msh3a2175b27cf041dp170feajsnf745f5536e94","X-RapidAPI-Host":"wft-geo-db.p.rapidapi.com"}});return 200===t.status?await t.json():Promise.reject(t)},r=(()=>{const e=e=>e.main.temp;return{getTemperatureFahrenheit:t=>{const r=9*(e(t)-273.15)/5+32;return Math.round(100*r)/100},getTemperatureCelsius:t=>{const r=e(t)-273.15;return Math.round(100*r)/100},getWeatherMain:e=>e.weather[0].main,getWeatherDescription:e=>e.weather[0].description,getWeatherIconCode:e=>e.weather[0].icon,getCityName:e=>e.name,getRandomCityName:e=>e.data[0].city,getCountryName:e=>{const t=(e=>e.sys.country)(e);return new Intl.DisplayNames(["en"],{type:"region"}).of(`${t}`)}}})(),o=(()=>{let e=!1;const t=e=>{e.classList.toggle("not-displayed")},o=e=>{document.querySelector(".loading-message").textContent=e},n=e=>new Promise((t=>setTimeout(t,e)));return{updateDisplayedWeather:e=>{(e=>{const t=r.getWeatherIconCode(e);document.querySelector(".weather-icon").src=`http://openweathermap.org/img/wn/${t}@4x.png`})(e),(e=>{const t=r.getWeatherMain(e);document.querySelector(".weather-main").textContent=t})(e),(e=>{const t=r.getWeatherDescription(e);document.querySelector(".weather-description").textContent=t})(e),(e=>{const t=r.getTemperatureFahrenheit(e);document.querySelector(".temp-f").textContent=`${t}째F`})(e),(e=>{const t=r.getTemperatureCelsius(e);document.querySelector(".temp-c").textContent=`${t}째C`})(e),(e=>{const t=r.getCityName(e);document.querySelector(".city-name").textContent=t})(e),(e=>{const t=r.getCountryName(e);document.querySelector(".country-name").textContent=t})(e),document.querySelector("#city").value=""},addPlaceholderValues:()=>{const e=document.querySelector(".weather-icon"),t=document.querySelector(".weather-main"),r=document.querySelector(".weather-description"),o=document.querySelector(".temp-f"),n=document.querySelector(".temp-c"),a=document.querySelector(".city-name");e.src="../dist/mickey.png",t.textContent="The sun might or might not be visible",r.textContent="hopefully the sky is still blue",o.textContent="Larger number째F",n.textContent="Smaller number째C",a.textContent="Disneyland"},changeErrorMessage:e=>{document.querySelector(".error-message").textContent=e},toggleElementDisplay:t,toggleLoadingInProgress:r=>{const a=document.querySelector("#loading-indicator");Array.from(document.querySelectorAll(".submission-element")).forEach((e=>{!1===e.disabled?e.disabled=!0:e.disabled=!1})),t(a),(async t=>{const r=document.querySelector("#loading-indicator");for(e=!e;e;){if(o(`${t}...`),await n(1e3),Array.from(r.classList).includes("not-displayed")){o(`${t}...`);break}if(o(`${t}.`),await n(1e3),Array.from(r.classList).includes("not-displayed")){o(`${t}...`);break}o(`${t}..`),await n(1e3),o(`${t}...`)}})(r)},resetError:()=>{const e=document.querySelector(".error-message");Array.from(e.classList).includes("not-displayed")||e.classList.add("not-displayed")}}})(),n=(()=>{const n=async()=>{const t=document.querySelector("#city").value;if(""!==t)try{const r=await e(t);o.updateDisplayedWeather(r)}catch(e){404===e.status?o.changeErrorMessage("Uh oh, looks like something went wrong! Check your spelling or try a different city!"):429===e.status?o.changeErrorMessage("Whoa, slow down there partner! Save some weather data for the rest of us!"):500===e.status&&o.changeErrorMessage("Something out of our control is broken. Try again later!");const t=document.querySelector(".error-message");o.toggleElementDisplay(t),console.error(Error(e.statusText))}o.toggleLoadingInProgress()},a=async()=>{let n,s;try{const a=await t();n=r.getRandomCityName(a),s=await e(n),o.updateDisplayedWeather(s),o.toggleLoadingInProgress()}catch(e){404===e.status&&void 0===n?o.changeErrorMessage("Hmm, it seems like we're running into some trouble. Try again!"):404===e.status&&void 0===s||429===e.status?setTimeout(a,1500):500===e.status&&o.changeErrorMessage("Something out of our control is broken. Try again later!"),console.error(Error(`${e.status} ${e.statusText}`))}};return{addUserInputListeners:()=>{document.querySelector(".search-button").addEventListener("click",(()=>{o.resetError(),o.toggleLoadingInProgress("Loading"),n()})),document.querySelector("#city").addEventListener("keydown",(e=>{"Enter"===e.key&&(o.resetError(),o.toggleLoadingInProgress("Loading"),n())})),document.querySelector(".random-button").addEventListener("click",(()=>{o.resetError(),o.toggleLoadingInProgress("Randomizing"),a()})),(()=>{const e=Array.from(document.querySelectorAll(".temp-button"));e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{o.toggleElementDisplay(e)}))}))}))})()}}})();!async function(){try{const t=await e("Hell");o.updateDisplayedWeather(t)}catch(e){o.addPlaceholderValues(),console.error(Error(`${e.status} ${e.statusText}. If you can see this, that means there was an issue with the OpenWeatherMap API!`))}}(),n.addUserInputListeners()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aW4td2VhdGhlci1hcHAvLi9zcmMvQVBJX3JlcXVlc3RfbW9kdWxlLmpzIiwid2VicGFjazovL29kaW4td2VhdGhlci1hcHAvLi9zcmMvZmlsdGVyX2RhdGFfbW9kdWxlLmpzIiwid2VicGFjazovL29kaW4td2VhdGhlci1hcHAvLi9zcmMvRE9NX21hbmlwdWxhdGlvbl9tb2R1bGUuanMiLCJ3ZWJwYWNrOi8vb2Rpbi13ZWF0aGVyLWFwcC8uL3NyYy91c2VyX2lucHV0X21vZHVsZS5qcyIsIndlYnBhY2s6Ly9vZGluLXdlYXRoZXItYXBwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEFQSVJlcXVlc3QgPSAoKCkgPT4ge1xuICBjb25zdCBBUElLRVkgPSBcImEwYzk4MzkzNjFmMzAxYWE0ZmY4YmIwODlkZGUyZDc5XCI7XG4gIGNvbnN0IGdldENpdHlXZWF0aGVyID0gYXN5bmMgKGNpdHkpID0+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgYGh0dHBzOi8vYXBpLm9wZW53ZWF0aGVybWFwLm9yZy9kYXRhLzIuNS93ZWF0aGVyP3E9JHtjaXR5fSZhcHBpZD0ke0FQSUtFWX1gXG4gICAgKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgIGNvbnN0IHBhcnNlZE9iamVjdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiBwYXJzZWRPYmplY3Q7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXNwb25zZSk7XG4gIH07XG4gIGNvbnN0IGdldFJhbmRvbUNpdHkgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgQ0lUWUNPVU5UID0gNTA4MDYxO1xuICAgIGNvbnN0IHJhbmRvbUNpdHlJbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIENJVFlDT1VOVCkgLSAxO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiWC1SYXBpZEFQSS1LZXlcIjogXCI4MDdlYTE4ZWMybXNoM2EyMTc1YjI3Y2YwNDFkcDE3MGZlYWpzbmY3NDVmNTUzNmU5NFwiLFxuICAgICAgICBcIlgtUmFwaWRBUEktSG9zdFwiOiBcIndmdC1nZW8tZGIucC5yYXBpZGFwaS5jb21cIixcbiAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgYGh0dHBzOi8vd2Z0LWdlby1kYi5wLnJhcGlkYXBpLmNvbS92MS9nZW8vY2l0aWVzP2xpbWl0PTEmaW5jbHVkZURlbGV0ZWQ9Tk9ORSZvZmZzZXQ9JHtyYW5kb21DaXR5SW5kZXh9YCxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgY29uc3QgcGFyc2VkT2JqZWN0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIHBhcnNlZE9iamVjdDtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlKTtcbiAgfTtcbiAgcmV0dXJuIHsgZ2V0Q2l0eVdlYXRoZXIsIGdldFJhbmRvbUNpdHkgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IEFQSVJlcXVlc3QgfTtcbiIsImNvbnN0IGZpbHRlckRhdGEgPSAoKCkgPT4ge1xuICBjb25zdCBnZXRUZW1wZXJhdHVyZSA9IChkYXRhKSA9PiBkYXRhLm1haW4udGVtcDtcbiAgY29uc3QgZ2V0VGVtcGVyYXR1cmVGYWhyZW5oZWl0ID0gKGRhdGEpID0+IHtcbiAgICBjb25zdCBrZWx2aW4gPSBnZXRUZW1wZXJhdHVyZShkYXRhKTtcbiAgICBjb25zdCBmYWhyZW5oZWl0ID0gKChrZWx2aW4gLSAyNzMuMTUpICogOSkgLyA1ICsgMzI7XG4gICAgcmV0dXJuIE1hdGgucm91bmQoZmFocmVuaGVpdCAqIDEwMCkgLyAxMDA7XG4gIH07XG4gIGNvbnN0IGdldFRlbXBlcmF0dXJlQ2Vsc2l1cyA9IChkYXRhKSA9PiB7XG4gICAgY29uc3Qga2VsdmluID0gZ2V0VGVtcGVyYXR1cmUoZGF0YSk7XG4gICAgY29uc3QgY2Vsc2l1cyA9IGtlbHZpbiAtIDI3My4xNTtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChjZWxzaXVzICogMTAwKSAvIDEwMDtcbiAgfTtcbiAgY29uc3QgZ2V0V2VhdGhlck1haW4gPSAoZGF0YSkgPT4gZGF0YS53ZWF0aGVyWzBdLm1haW47XG4gIGNvbnN0IGdldFdlYXRoZXJEZXNjcmlwdGlvbiA9IChkYXRhKSA9PiBkYXRhLndlYXRoZXJbMF0uZGVzY3JpcHRpb247XG4gIGNvbnN0IGdldFdlYXRoZXJJY29uQ29kZSA9IChkYXRhKSA9PiBkYXRhLndlYXRoZXJbMF0uaWNvbjtcbiAgY29uc3QgZ2V0Q2l0eU5hbWUgPSAoZGF0YSkgPT4gZGF0YS5uYW1lO1xuICBjb25zdCBnZXRDb3VudHJ5Q29kZSA9IChkYXRhKSA9PiBkYXRhLnN5cy5jb3VudHJ5O1xuICBjb25zdCBnZXRDb3VudHJ5TmFtZSA9IChkYXRhKSA9PiB7XG4gICAgY29uc3QgY291bnRyeUNvZGUgPSBnZXRDb3VudHJ5Q29kZShkYXRhKTtcbiAgICBjb25zdCByZWdpb25OYW1lcyA9IG5ldyBJbnRsLkRpc3BsYXlOYW1lcyhbXCJlblwiXSwgeyB0eXBlOiBcInJlZ2lvblwiIH0pO1xuICAgIGNvbnN0IGNvdW50cnlOYW1lID0gcmVnaW9uTmFtZXMub2YoYCR7Y291bnRyeUNvZGV9YCk7XG4gICAgcmV0dXJuIGNvdW50cnlOYW1lO1xuICB9O1xuICBjb25zdCBnZXRSYW5kb21DaXR5TmFtZSA9IChkYXRhKSA9PiBkYXRhLmRhdGFbMF0uY2l0eTtcbiAgcmV0dXJuIHtcbiAgICBnZXRUZW1wZXJhdHVyZUZhaHJlbmhlaXQsXG4gICAgZ2V0VGVtcGVyYXR1cmVDZWxzaXVzLFxuICAgIGdldFdlYXRoZXJNYWluLFxuICAgIGdldFdlYXRoZXJEZXNjcmlwdGlvbixcbiAgICBnZXRXZWF0aGVySWNvbkNvZGUsXG4gICAgZ2V0Q2l0eU5hbWUsXG4gICAgZ2V0UmFuZG9tQ2l0eU5hbWUsXG4gICAgZ2V0Q291bnRyeU5hbWUsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgeyBmaWx0ZXJEYXRhIH07XG4iLCJpbXBvcnQgeyBmaWx0ZXJEYXRhIH0gZnJvbSBcIi4vZmlsdGVyX2RhdGFfbW9kdWxlXCI7XG5cbmNvbnN0IERPTU1hbmlwdWxhdGlvbiA9ICgoKSA9PiB7XG4gIGxldCB0aW1lciA9IGZhbHNlO1xuICBjb25zdCBhZGRXZWF0aGVySWNvbiA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IHdlYXRoZXJJY29uID0gZmlsdGVyRGF0YS5nZXRXZWF0aGVySWNvbkNvZGUod2VhdGhlckRhdGEpO1xuICAgIGNvbnN0IHdlYXRoZXJJY29uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud2VhdGhlci1pY29uXCIpO1xuICAgIHdlYXRoZXJJY29uRWxlbWVudC5zcmMgPSBgaHR0cDovL29wZW53ZWF0aGVybWFwLm9yZy9pbWcvd24vJHt3ZWF0aGVySWNvbn1ANHgucG5nYDtcbiAgfTtcbiAgY29uc3QgYWRkV2VhdGhlck1haW4gPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBjb25zdCB3ZWF0aGVyTWFpbiA9IGZpbHRlckRhdGEuZ2V0V2VhdGhlck1haW4od2VhdGhlckRhdGEpO1xuICAgIGNvbnN0IHdlYXRoZXJNYWluRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud2VhdGhlci1tYWluXCIpO1xuICAgIHdlYXRoZXJNYWluRWxlbWVudC50ZXh0Q29udGVudCA9IHdlYXRoZXJNYWluO1xuICB9O1xuICBjb25zdCBhZGRXZWF0aGVyRGVzY3JpcHRpb24gPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBjb25zdCB3ZWF0aGVyRGVzY3JpcHRpb24gPSBmaWx0ZXJEYXRhLmdldFdlYXRoZXJEZXNjcmlwdGlvbih3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3Qgd2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi53ZWF0aGVyLWRlc2NyaXB0aW9uXCJcbiAgICApO1xuICAgIHdlYXRoZXJEZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSB3ZWF0aGVyRGVzY3JpcHRpb247XG4gIH07XG4gIGNvbnN0IGFkZFRlbXBlcmF0dXJlRmFocmVuaGVpdCA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IHRlbXBGID0gZmlsdGVyRGF0YS5nZXRUZW1wZXJhdHVyZUZhaHJlbmhlaXQod2VhdGhlckRhdGEpO1xuICAgIGNvbnN0IHRlbXBGRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVtcC1mXCIpO1xuICAgIHRlbXBGRWxlbWVudC50ZXh0Q29udGVudCA9IGAke3RlbXBGfcKwRmA7XG4gIH07XG4gIGNvbnN0IGFkZFRlbXBlcmF0dXJlQ2Vsc2l1cyA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IHRlbXBDID0gZmlsdGVyRGF0YS5nZXRUZW1wZXJhdHVyZUNlbHNpdXMod2VhdGhlckRhdGEpO1xuICAgIGNvbnN0IHRlbXBDRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVtcC1jXCIpO1xuICAgIHRlbXBDRWxlbWVudC50ZXh0Q29udGVudCA9IGAke3RlbXBDfcKwQ2A7XG4gIH07XG4gIGNvbnN0IGFkZENpdHlOYW1lID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3QgY2l0eU5hbWUgPSBmaWx0ZXJEYXRhLmdldENpdHlOYW1lKHdlYXRoZXJEYXRhKTtcbiAgICBjb25zdCBjaXR5TmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNpdHktbmFtZVwiKTtcbiAgICBjaXR5TmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBjaXR5TmFtZTtcbiAgfTtcbiAgY29uc3QgYWRkQ291bnRyeU5hbWUgPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBjb25zdCBjb3VudHJ5TmFtZSA9IGZpbHRlckRhdGEuZ2V0Q291bnRyeU5hbWUod2VhdGhlckRhdGEpO1xuICAgIGNvbnN0IGNvdW50cnlOYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY291bnRyeS1uYW1lXCIpO1xuICAgIGNvdW50cnlOYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGNvdW50cnlOYW1lO1xuICB9O1xuICBjb25zdCByZXNldElucHV0VmFsdWUgPSAoKSA9PiB7XG4gICAgY29uc3QgY2l0eUlucHV0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2l0eVwiKTtcbiAgICBjaXR5SW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcbiAgfTtcbiAgY29uc3QgdXBkYXRlRGlzcGxheWVkV2VhdGhlciA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGFkZFdlYXRoZXJJY29uKHdlYXRoZXJEYXRhKTtcbiAgICBhZGRXZWF0aGVyTWFpbih3ZWF0aGVyRGF0YSk7XG4gICAgYWRkV2VhdGhlckRlc2NyaXB0aW9uKHdlYXRoZXJEYXRhKTtcbiAgICBhZGRUZW1wZXJhdHVyZUZhaHJlbmhlaXQod2VhdGhlckRhdGEpO1xuICAgIGFkZFRlbXBlcmF0dXJlQ2Vsc2l1cyh3ZWF0aGVyRGF0YSk7XG4gICAgYWRkQ2l0eU5hbWUod2VhdGhlckRhdGEpO1xuICAgIGFkZENvdW50cnlOYW1lKHdlYXRoZXJEYXRhKTtcbiAgICByZXNldElucHV0VmFsdWUoKTtcbiAgfTtcbiAgY29uc3QgYWRkUGxhY2Vob2xkZXJWYWx1ZXMgPSAoKSA9PiB7XG4gICAgY29uc3Qgd2VhdGhlckljb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWF0aGVyLWljb25cIik7XG4gICAgY29uc3Qgd2VhdGhlck1haW5FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWF0aGVyLW1haW5cIik7XG4gICAgY29uc3Qgd2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi53ZWF0aGVyLWRlc2NyaXB0aW9uXCJcbiAgICApO1xuICAgIGNvbnN0IHRlbXBGRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVtcC1mXCIpO1xuICAgIGNvbnN0IHRlbXBDRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVtcC1jXCIpO1xuICAgIGNvbnN0IGNpdHlOYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2l0eS1uYW1lXCIpO1xuICAgIHdlYXRoZXJJY29uRWxlbWVudC5zcmMgPSBcIi4uL2Rpc3QvbWlja2V5LnBuZ1wiO1xuICAgIHdlYXRoZXJNYWluRWxlbWVudC50ZXh0Q29udGVudCA9IFwiVGhlIHN1biBtaWdodCBvciBtaWdodCBub3QgYmUgdmlzaWJsZVwiO1xuICAgIHdlYXRoZXJEZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBcImhvcGVmdWxseSB0aGUgc2t5IGlzIHN0aWxsIGJsdWVcIjtcbiAgICB0ZW1wRkVsZW1lbnQudGV4dENvbnRlbnQgPSBcIkxhcmdlciBudW1iZXLCsEZcIjtcbiAgICB0ZW1wQ0VsZW1lbnQudGV4dENvbnRlbnQgPSBcIlNtYWxsZXIgbnVtYmVywrBDXCI7XG4gICAgY2l0eU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gXCJEaXNuZXlsYW5kXCI7XG4gIH07XG4gIGNvbnN0IGNoYW5nZUVycm9yTWVzc2FnZSA9IChtZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZXJyb3ItbWVzc2FnZVwiKTtcbiAgICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gbWVzc2FnZTtcbiAgfTtcbiAgY29uc3QgdG9nZ2xlU3VibWlzc2lvbkVsZW1lbnRzRW5hYmxlZCA9ICgpID0+IHtcbiAgICBjb25zdCBzdWJtaXNzaW9uRWxlbWVudHMgPSBBcnJheS5mcm9tKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zdWJtaXNzaW9uLWVsZW1lbnRcIilcbiAgICApO1xuICAgIHN1Ym1pc3Npb25FbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBpZiAoZWxlbWVudC5kaXNhYmxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgZWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IHRvZ2dsZUVsZW1lbnREaXNwbGF5ID0gKGVsZW1lbnQpID0+IHtcbiAgICBlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJub3QtZGlzcGxheWVkXCIpO1xuICB9O1xuICBjb25zdCBjaGFuZ2VMb2FkaW5nTWVzc2FnZSA9IChtZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgbG9hZGluZ01lc3NhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmxvYWRpbmctbWVzc2FnZVwiKTtcbiAgICBsb2FkaW5nTWVzc2FnZS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gIH07XG4gIGNvbnN0IHdhaXRUaW1lciA9IChkdXJhdGlvbikgPT5cbiAgICBuZXcgUHJvbWlzZSgocmVzcG9uc2UpID0+IHNldFRpbWVvdXQocmVzcG9uc2UsIGR1cmF0aW9uKSk7XG4gIGNvbnN0IHRvZ2dsZUxvYWRpbmdNZXNzYWdlQ3ljbGUgPSBhc3luYyAobG9hZGluZ01lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBsb2FkaW5nSW5kaWNhdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nLWluZGljYXRvclwiKTtcbiAgICB0aW1lciA/ICh0aW1lciA9IGZhbHNlKSA6ICh0aW1lciA9IHRydWUpO1xuICAgIHdoaWxlICh0aW1lcikge1xuICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9Li4uYCk7XG4gICAgICBhd2FpdCB3YWl0VGltZXIoMTAwMCk7XG4gICAgICBpZiAoQXJyYXkuZnJvbShsb2FkaW5nSW5kaWNhdG9yLmNsYXNzTGlzdCkuaW5jbHVkZXMoXCJub3QtZGlzcGxheWVkXCIpKSB7XG4gICAgICAgIGNoYW5nZUxvYWRpbmdNZXNzYWdlKGAke2xvYWRpbmdNZXNzYWdlfS4uLmApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNoYW5nZUxvYWRpbmdNZXNzYWdlKGAke2xvYWRpbmdNZXNzYWdlfS5gKTtcbiAgICAgIGF3YWl0IHdhaXRUaW1lcigxMDAwKTtcbiAgICAgIGlmIChBcnJheS5mcm9tKGxvYWRpbmdJbmRpY2F0b3IuY2xhc3NMaXN0KS5pbmNsdWRlcyhcIm5vdC1kaXNwbGF5ZWRcIikpIHtcbiAgICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9Li4uYCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9Li5gKTtcbiAgICAgIGF3YWl0IHdhaXRUaW1lcigxMDAwKTtcbiAgICAgIGNoYW5nZUxvYWRpbmdNZXNzYWdlKGAke2xvYWRpbmdNZXNzYWdlfS4uLmApO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgdG9nZ2xlTG9hZGluZ0luUHJvZ3Jlc3MgPSAobG9hZGluZ01lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBsb2FkaW5nSW5kaWNhdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nLWluZGljYXRvclwiKTtcbiAgICB0b2dnbGVTdWJtaXNzaW9uRWxlbWVudHNFbmFibGVkKCk7XG4gICAgdG9nZ2xlRWxlbWVudERpc3BsYXkobG9hZGluZ0luZGljYXRvcik7XG4gICAgdG9nZ2xlTG9hZGluZ01lc3NhZ2VDeWNsZShsb2FkaW5nTWVzc2FnZSk7XG4gIH07XG4gIGNvbnN0IHJlc2V0RXJyb3IgPSAoKSA9PiB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZXJyb3ItbWVzc2FnZVwiKTtcbiAgICBpZiAoIUFycmF5LmZyb20oZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QpLmluY2x1ZGVzKFwibm90LWRpc3BsYXllZFwiKSkge1xuICAgICAgZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibm90LWRpc3BsYXllZFwiKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiB7XG4gICAgdXBkYXRlRGlzcGxheWVkV2VhdGhlcixcbiAgICBhZGRQbGFjZWhvbGRlclZhbHVlcyxcbiAgICBjaGFuZ2VFcnJvck1lc3NhZ2UsXG4gICAgdG9nZ2xlRWxlbWVudERpc3BsYXksXG4gICAgdG9nZ2xlTG9hZGluZ0luUHJvZ3Jlc3MsXG4gICAgcmVzZXRFcnJvcixcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IERPTU1hbmlwdWxhdGlvbiB9O1xuIiwiaW1wb3J0IHsgQVBJUmVxdWVzdCB9IGZyb20gXCIuL0FQSV9yZXF1ZXN0X21vZHVsZVwiO1xuaW1wb3J0IHsgZmlsdGVyRGF0YSB9IGZyb20gXCIuL2ZpbHRlcl9kYXRhX21vZHVsZVwiO1xuaW1wb3J0IHsgRE9NTWFuaXB1bGF0aW9uIH0gZnJvbSBcIi4vRE9NX21hbmlwdWxhdGlvbl9tb2R1bGVcIjtcblxuY29uc3QgdXNlcklucHV0ID0gKCgpID0+IHtcbiAgY29uc3Qgc3VibWl0VXNlcklucHV0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGNpdHlJbnB1dFZhbHVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjaXR5XCIpLnZhbHVlO1xuICAgIGlmIChjaXR5SW5wdXRWYWx1ZSAhPT0gXCJcIikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBBUElSZXF1ZXN0LmdldENpdHlXZWF0aGVyKGNpdHlJbnB1dFZhbHVlKTtcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnVwZGF0ZURpc3BsYXllZFdlYXRoZXIocmVzcG9uc2UpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgLy8gT3BlbldlYXRoZXJNYXAgQVBJIGNhbid0IGZpbmQgdGhlIGNpdHkgZHVlIHRvIG1pc3NwZWxsaW5nIG9yIGxhY2sgb2YgZGF0YVxuICAgICAgICAgIERPTU1hbmlwdWxhdGlvbi5jaGFuZ2VFcnJvck1lc3NhZ2UoXG4gICAgICAgICAgICBcIlVoIG9oLCBsb29rcyBsaWtlIHNvbWV0aGluZyB3ZW50IHdyb25nISBDaGVjayB5b3VyIHNwZWxsaW5nIG9yIHRyeSBhIGRpZmZlcmVudCBjaXR5IVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvci5zdGF0dXMgPT09IDQyOSkge1xuICAgICAgICAgIC8vIE9wZW5XZWF0aGVyTWFwIEFQSSByYXRlIGxpbWl0XG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICAgIFwiV2hvYSwgc2xvdyBkb3duIHRoZXJlIHBhcnRuZXIhIFNhdmUgc29tZSB3ZWF0aGVyIGRhdGEgZm9yIHRoZSByZXN0IG9mIHVzIVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvci5zdGF0dXMgPT09IDUwMCkge1xuICAgICAgICAgIERPTU1hbmlwdWxhdGlvbi5jaGFuZ2VFcnJvck1lc3NhZ2UoXG4gICAgICAgICAgICBcIlNvbWV0aGluZyBvdXQgb2Ygb3VyIGNvbnRyb2wgaXMgYnJva2VuLiBUcnkgYWdhaW4gbGF0ZXIhXCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVycm9yLW1lc3NhZ2VcIik7XG4gICAgICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVFbGVtZW50RGlzcGxheShlcnJvck1lc3NhZ2VFbGVtZW50KTtcbiAgICAgICAgY29uc29sZS5lcnJvcihFcnJvcihlcnJvci5zdGF0dXNUZXh0KSk7XG4gICAgICB9XG4gICAgfVxuICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcygpO1xuICB9O1xuICBjb25zdCBzdWJtaXRSYW5kb21JbnB1dCA9IGFzeW5jICgpID0+IHtcbiAgICBsZXQgcmFuZG9tQ2l0eU5hbWU7XG4gICAgbGV0IHdlYXRoZXJSZXNwb25zZTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY2l0eVJlc3BvbnNlID0gYXdhaXQgQVBJUmVxdWVzdC5nZXRSYW5kb21DaXR5KCk7XG4gICAgICByYW5kb21DaXR5TmFtZSA9IGZpbHRlckRhdGEuZ2V0UmFuZG9tQ2l0eU5hbWUoY2l0eVJlc3BvbnNlKTtcbiAgICAgIHdlYXRoZXJSZXNwb25zZSA9IGF3YWl0IEFQSVJlcXVlc3QuZ2V0Q2l0eVdlYXRoZXIocmFuZG9tQ2l0eU5hbWUpO1xuICAgICAgRE9NTWFuaXB1bGF0aW9uLnVwZGF0ZURpc3BsYXllZFdlYXRoZXIod2VhdGhlclJlc3BvbnNlKTtcbiAgICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcygpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDQgJiYgcmFuZG9tQ2l0eU5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBHZW9EQiBBUEkgZXJyb3JcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICBcIkhtbSwgaXQgc2VlbXMgbGlrZSB3ZSdyZSBydW5uaW5nIGludG8gc29tZSB0cm91YmxlLiBUcnkgYWdhaW4hXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIChlcnJvci5zdGF0dXMgPT09IDQwNCAmJiB3ZWF0aGVyUmVzcG9uc2UgPT09IHVuZGVmaW5lZCkgfHxcbiAgICAgICAgZXJyb3Iuc3RhdHVzID09PSA0MjlcbiAgICAgICkge1xuICAgICAgICAvLyBHZW9EQiBnYXZlIGEgY2l0eSB0aGF0IGhhcyBubyBkYXRhIGluIE9wZW5XZWF0aGVyTWFwIEFQSVxuICAgICAgICBzZXRUaW1lb3V0KHN1Ym1pdFJhbmRvbUlucHV0LCAxNTAwKTtcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3Iuc3RhdHVzID09PSA1MDApIHtcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICBcIlNvbWV0aGluZyBvdXQgb2Ygb3VyIGNvbnRyb2wgaXMgYnJva2VuLiBUcnkgYWdhaW4gbGF0ZXIhXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUuZXJyb3IoRXJyb3IoYCR7ZXJyb3Iuc3RhdHVzfSAke2Vycm9yLnN0YXR1c1RleHR9YCkpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYWRkU2VhcmNoQnV0dG9uTGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2VhcmNoQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZWFyY2gtYnV0dG9uXCIpO1xuICAgIHNlYXJjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgRE9NTWFuaXB1bGF0aW9uLnJlc2V0RXJyb3IoKSxcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKFwiTG9hZGluZ1wiKSxcbiAgICAgICAgc3VibWl0VXNlcklucHV0KCk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGFkZElucHV0RWxlbWVudExpc3RlbmVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGNpdHlJbnB1dEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NpdHlcIik7XG4gICAgY2l0eUlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICBET01NYW5pcHVsYXRpb24ucmVzZXRFcnJvcigpLFxuICAgICAgICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyhcIkxvYWRpbmdcIiksXG4gICAgICAgICAgc3VibWl0VXNlcklucHV0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGFkZFJhbmRvbUJ1dHRvbkxpc3RlbmVyID0gKCkgPT4ge1xuICAgIGNvbnN0IHJhbmRvbUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFuZG9tLWJ1dHRvblwiKTtcbiAgICByYW5kb21CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIERPTU1hbmlwdWxhdGlvbi5yZXNldEVycm9yKCksXG4gICAgICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyhcIlJhbmRvbWl6aW5nXCIpLFxuICAgICAgICBzdWJtaXRSYW5kb21JbnB1dCgpO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGRUZW1wZXJhdHVyZUJ1dHRvbkxpc3RlbmVycyA9ICgpID0+IHtcbiAgICBjb25zdCB0ZW1wQnV0dG9ucyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50ZW1wLWJ1dHRvblwiKSk7XG4gICAgdGVtcEJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGVtcEJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUVsZW1lbnREaXNwbGF5KGJ1dHRvbik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGFkZFVzZXJJbnB1dExpc3RlbmVycyA9ICgpID0+IHtcbiAgICBhZGRTZWFyY2hCdXR0b25MaXN0ZW5lcigpO1xuICAgIGFkZElucHV0RWxlbWVudExpc3RlbmVyKCk7XG4gICAgYWRkUmFuZG9tQnV0dG9uTGlzdGVuZXIoKTtcbiAgICBhZGRUZW1wZXJhdHVyZUJ1dHRvbkxpc3RlbmVycygpO1xuICB9O1xuICByZXR1cm4geyBhZGRVc2VySW5wdXRMaXN0ZW5lcnMgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IHVzZXJJbnB1dCB9O1xuIiwiaW1wb3J0IHsgQVBJUmVxdWVzdCB9IGZyb20gXCIuL0FQSV9yZXF1ZXN0X21vZHVsZVwiO1xuaW1wb3J0IHsgdXNlcklucHV0IH0gZnJvbSBcIi4vdXNlcl9pbnB1dF9tb2R1bGVcIjtcbmltcG9ydCB7IERPTU1hbmlwdWxhdGlvbiB9IGZyb20gXCIuL0RPTV9tYW5pcHVsYXRpb25fbW9kdWxlXCI7XG5cbihhc3luYyBmdW5jdGlvbiBpbml0aWFsaXplUGFnZSgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEFQSVJlcXVlc3QuZ2V0Q2l0eVdlYXRoZXIoXCJIZWxsXCIpO1xuICAgIERPTU1hbmlwdWxhdGlvbi51cGRhdGVEaXNwbGF5ZWRXZWF0aGVyKHJlc3BvbnNlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBET01NYW5pcHVsYXRpb24uYWRkUGxhY2Vob2xkZXJWYWx1ZXMoKTtcbiAgICBjb25zb2xlLmVycm9yKFxuICAgICAgRXJyb3IoXG4gICAgICAgIGAke2Vycm9yLnN0YXR1c30gJHtlcnJvci5zdGF0dXNUZXh0fS4gSWYgeW91IGNhbiBzZWUgdGhpcywgdGhhdCBtZWFucyB0aGVyZSB3YXMgYW4gaXNzdWUgd2l0aCB0aGUgT3BlbldlYXRoZXJNYXAgQVBJIWBcbiAgICAgIClcbiAgICApO1xuICB9XG59KSgpO1xuXG51c2VySW5wdXQuYWRkVXNlcklucHV0TGlzdGVuZXJzKCk7XG4iXSwibmFtZXMiOlsiQVBJUmVxdWVzdCIsImFzeW5jIiwiY2l0eSIsInJlc3BvbnNlIiwiZmV0Y2giLCJzdGF0dXMiLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInJhbmRvbUNpdHlJbmRleCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm1ldGhvZCIsImhlYWRlcnMiLCJmaWx0ZXJEYXRhIiwiZ2V0VGVtcGVyYXR1cmUiLCJkYXRhIiwibWFpbiIsInRlbXAiLCJnZXRUZW1wZXJhdHVyZUZhaHJlbmhlaXQiLCJmYWhyZW5oZWl0Iiwicm91bmQiLCJnZXRUZW1wZXJhdHVyZUNlbHNpdXMiLCJjZWxzaXVzIiwiZ2V0V2VhdGhlck1haW4iLCJ3ZWF0aGVyIiwiZ2V0V2VhdGhlckRlc2NyaXB0aW9uIiwiZGVzY3JpcHRpb24iLCJnZXRXZWF0aGVySWNvbkNvZGUiLCJpY29uIiwiZ2V0Q2l0eU5hbWUiLCJuYW1lIiwiZ2V0UmFuZG9tQ2l0eU5hbWUiLCJnZXRDb3VudHJ5TmFtZSIsImNvdW50cnlDb2RlIiwic3lzIiwiY291bnRyeSIsImdldENvdW50cnlDb2RlIiwiSW50bCIsIkRpc3BsYXlOYW1lcyIsInR5cGUiLCJvZiIsIkRPTU1hbmlwdWxhdGlvbiIsInRpbWVyIiwidG9nZ2xlRWxlbWVudERpc3BsYXkiLCJlbGVtZW50IiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwiY2hhbmdlTG9hZGluZ01lc3NhZ2UiLCJtZXNzYWdlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidGV4dENvbnRlbnQiLCJ3YWl0VGltZXIiLCJkdXJhdGlvbiIsInNldFRpbWVvdXQiLCJ1cGRhdGVEaXNwbGF5ZWRXZWF0aGVyIiwid2VhdGhlckRhdGEiLCJ3ZWF0aGVySWNvbiIsInNyYyIsImFkZFdlYXRoZXJJY29uIiwid2VhdGhlck1haW4iLCJhZGRXZWF0aGVyTWFpbiIsIndlYXRoZXJEZXNjcmlwdGlvbiIsImFkZFdlYXRoZXJEZXNjcmlwdGlvbiIsInRlbXBGIiwiYWRkVGVtcGVyYXR1cmVGYWhyZW5oZWl0IiwidGVtcEMiLCJhZGRUZW1wZXJhdHVyZUNlbHNpdXMiLCJjaXR5TmFtZSIsImFkZENpdHlOYW1lIiwiY291bnRyeU5hbWUiLCJhZGRDb3VudHJ5TmFtZSIsInZhbHVlIiwiYWRkUGxhY2Vob2xkZXJWYWx1ZXMiLCJ3ZWF0aGVySWNvbkVsZW1lbnQiLCJ3ZWF0aGVyTWFpbkVsZW1lbnQiLCJ3ZWF0aGVyRGVzY3JpcHRpb25FbGVtZW50IiwidGVtcEZFbGVtZW50IiwidGVtcENFbGVtZW50IiwiY2l0eU5hbWVFbGVtZW50IiwiY2hhbmdlRXJyb3JNZXNzYWdlIiwidG9nZ2xlTG9hZGluZ0luUHJvZ3Jlc3MiLCJsb2FkaW5nTWVzc2FnZSIsImxvYWRpbmdJbmRpY2F0b3IiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImRpc2FibGVkIiwiaW5jbHVkZXMiLCJ0b2dnbGVMb2FkaW5nTWVzc2FnZUN5Y2xlIiwicmVzZXRFcnJvciIsImVycm9yTWVzc2FnZUVsZW1lbnQiLCJhZGQiLCJ1c2VySW5wdXQiLCJzdWJtaXRVc2VySW5wdXQiLCJjaXR5SW5wdXRWYWx1ZSIsImVycm9yIiwiY29uc29sZSIsIkVycm9yIiwic3RhdHVzVGV4dCIsInN1Ym1pdFJhbmRvbUlucHV0IiwicmFuZG9tQ2l0eU5hbWUiLCJ3ZWF0aGVyUmVzcG9uc2UiLCJjaXR5UmVzcG9uc2UiLCJ1bmRlZmluZWQiLCJhZGRVc2VySW5wdXRMaXN0ZW5lcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJrZXkiLCJ0ZW1wQnV0dG9ucyIsImJ1dHRvbiIsImFkZFRlbXBlcmF0dXJlQnV0dG9uTGlzdGVuZXJzIl0sInNvdXJjZVJvb3QiOiIifQ==