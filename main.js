(()=>{"use strict";const e=async e=>{const t=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${e}&appid=a0c9839361f301aa4ff8bb089dde2d79`);return 200===t.status?await t.json():Promise.reject(t)},t=async()=>{const e=Math.floor(508061*Math.random())-1,t=await fetch(`https://wft-geo-db.p.rapidapi.com/v1/geo/cities?limit=1&includeDeleted=NONE&offset=${e}`,{method:"GET",headers:{"X-RapidAPI-Key":"807ea18ec2msh3a2175b27cf041dp170feajsnf745f5536e94","X-RapidAPI-Host":"wft-geo-db.p.rapidapi.com"}});return 200===t.status?await t.json():Promise.reject(t)},r=(()=>{const e=e=>e.main.temp;return{getTemperatureFahrenheit:t=>{const r=9*(e(t)-273.15)/5+32;return Math.round(100*r)/100},getTemperatureCelsius:t=>{const r=e(t)-273.15;return Math.round(100*r)/100},getWeatherMain:e=>e.weather[0].main,getWeatherDescription:e=>e.weather[0].description,getWeatherIconCode:e=>e.weather[0].icon,getCityName:e=>e.name,getRandomCityName:e=>e.data[0].city}})(),o=(()=>{let e=!1;const t=e=>{document.querySelector(".error-message").textContent=e},o=e=>{e.classList.toggle("not-displayed")},a=e=>{document.querySelector(".loading-message").textContent=e},n=e=>new Promise((t=>setTimeout(t,e)));return{updateDisplayedWeather:e=>{(e=>{const t=r.getWeatherIconCode(e);document.querySelector(".weather-icon").src=`http://openweathermap.org/img/wn/${t}@4x.png`})(e),(e=>{const t=r.getWeatherMain(e);document.querySelector(".weather-main").textContent=t})(e),(e=>{const t=r.getWeatherDescription(e);document.querySelector(".weather-description").textContent=t})(e),(e=>{const t=r.getTemperatureFahrenheit(e);document.querySelector(".temp-f").textContent=`${t}째F`})(e),(e=>{const t=r.getTemperatureCelsius(e);document.querySelector(".temp-c").textContent=`${t}째C`})(e),(e=>{const t=r.getCityName(e);document.querySelector(".city-name").textContent=t})(e),document.querySelector("#city").value=""},addPlaceholderValues:()=>{const e=document.querySelector(".weather-icon"),t=document.querySelector(".weather-main"),r=document.querySelector(".weather-description"),o=document.querySelector(".temp-f"),a=document.querySelector(".temp-c"),n=document.querySelector(".city-name");e.src="../dist/mickey.png",t.textContent="The sun might or might not be visible",r.textContent="hopefully the sky is still blue",o.textContent="Larger number째F",a.textContent="Smaller number째C",n.textContent="Disneyland"},changeErrorMessage:t,toggleElementDisplay:o,toggleLoadingInProgress:t=>{const r=document.querySelector("#loading-indicator");Array.from(document.querySelectorAll(".submission-element")).forEach((e=>{!1===e.disabled?e.disabled=!0:e.disabled=!1})),o(r),(async t=>{const r=document.querySelector("#loading-indicator");for(e=!e;e;){if(a(`${t}...`),await n(1e3),Array.from(r.classList).includes("not-displayed")){a(`${t}...`);break}if(a(`${t}.`),await n(1e3),Array.from(r.classList).includes("not-displayed")){a(`${t}...`);break}a(`${t}..`),await n(1e3),a(`${t}...`)}})(t)},resetError:()=>{const e=document.querySelector(".error-message");Array.from(e.classList).includes("not-displayed")||e.classList.add("not-displayed"),t("")}}})(),a=(()=>{const a=async()=>{const t=document.querySelector("#city").value;if(""!==t)try{const r=await e(t);o.updateDisplayedWeather(r)}catch(e){404===e.status?o.changeErrorMessage("Uh oh, looks like something went wrong! Check your spelling or try a different city!"):429===e.status?o.changeErrorMessage("Whoa, slow down there partner! Save some weather data for the rest of us!"):500===e.status&&o.changeErrorMessage("Something out of our control is broken. Try again later!");const t=document.querySelector(".error-message");o.toggleElementDisplay(t),console.error(Error(e.statusText))}o.toggleLoadingInProgress()},n=async()=>{let a,s;try{const n=await t();a=r.getRandomCityName(n),s=await e(a),o.updateDisplayedWeather(s),o.toggleLoadingInProgress()}catch(e){404===e.status&&void 0===a?o.changeErrorMessage("Hmm, it seems like we're running into some trouble. Try again!"):404===e.status&&void 0===s||429===e.status?setTimeout(n,1500):500===e.status&&o.changeErrorMessage("Something out of our control is broken. Try again later!"),console.error(Error(`${e.status} ${e.statusText}`))}};return{addUserInputListeners:()=>{document.querySelector(".search-button").addEventListener("click",(()=>{o.resetError(),o.toggleLoadingInProgress("Loading"),a()})),document.querySelector("#city").addEventListener("keydown",(e=>{"Enter"===e.key&&(o.resetError(),o.toggleLoadingInProgress("Loading"),a())})),document.querySelector(".random-button").addEventListener("click",(()=>{o.resetError(),o.toggleLoadingInProgress("Randomizing"),n()})),(()=>{const e=Array.from(document.querySelectorAll(".temp-button"));e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{o.toggleElementDisplay(e)}))}))}))})()}}})();!async function(){try{const t=await e("Hell");o.updateDisplayedWeather(t)}catch(e){o.addPlaceholderValues(),console.error(Error(`${e.status} ${e.statusText}. If you can see this, that means there was an issue with the OpenWeatherMap API!`))}}(),a.addUserInputListeners()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFjLGtCQUMvQjJELGlCQUFpQixTQUFTLEtBRXJDaEUsRUFBZ0JnRCxhQUNkaEQsRUFBZ0JzQyx3QkFBd0IsV0FDeENjLEdBQWlCLElBSUloRCxTQUFTQyxjQUFjLFNBQy9CMkQsaUJBQWlCLFdBQVlDLElBQzFCLFVBQWRBLEVBQU1DLE1BRVJsRSxFQUFnQmdELGFBQ2RoRCxFQUFnQnNDLHdCQUF3QixXQUN4Q2MsSUFDSixJQUltQmhELFNBQVNDLGNBQWMsa0JBQy9CMkQsaUJBQWlCLFNBQVMsS0FFckNoRSxFQUFnQmdELGFBQ2RoRCxFQUFnQnNDLHdCQUF3QixlQUN4Q29CLEdBQW1CLElBR2EsTUFDcEMsTUFBTVMsRUFBYzFCLE1BQU1DLEtBQUt0QyxTQUFTdUMsaUJBQWlCLGlCQUN6RHdCLEVBQVl2QixTQUFTd0IsSUFDbkJBLEVBQU9KLGlCQUFpQixTQUFTLEtBQy9CRyxFQUFZdkIsU0FBU3dCLElBQ25CcEUsRUFBZ0JPLHFCQUFxQjZELEVBQU8sR0FDNUMsR0FDRixHQUNGLEVBTUZDLEVBQStCLEVBR2xDLEVBekdpQixJQ0FsQixpQkFDRSxJQUNFLE1BQU1wRyxRQUFpQkgsRUFBMEIsUUFDakRrQyxFQUFnQmUsdUJBQXVCOUMsRUFRekMsQ0FQRSxNQUFPcUYsR0FDUHRELEVBQWdCK0IsdUJBQ2hCd0IsUUFBUUQsTUFDTkUsTUFDRSxHQUFHRixFQUFNbkYsVUFBVW1GLEVBQU1HLCtGQUcvQixDQUNELENBWkQsR0FjQU4sRUFBVVksdUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vZGluLXdlYXRoZXItYXBwLy4vc3JjL0FQSV9yZXF1ZXN0X21vZHVsZS5qcyIsIndlYnBhY2s6Ly9vZGluLXdlYXRoZXItYXBwLy4vc3JjL2ZpbHRlcl9kYXRhX21vZHVsZS5qcyIsIndlYnBhY2s6Ly9vZGluLXdlYXRoZXItYXBwLy4vc3JjL0RPTV9tYW5pcHVsYXRpb25fbW9kdWxlLmpzIiwid2VicGFjazovL29kaW4td2VhdGhlci1hcHAvLi9zcmMvdXNlcl9pbnB1dF9tb2R1bGUuanMiLCJ3ZWJwYWNrOi8vb2Rpbi13ZWF0aGVyLWFwcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBBUElSZXF1ZXN0ID0gKCgpID0+IHtcbiAgY29uc3QgQVBJS0VZID0gXCJhMGM5ODM5MzYxZjMwMWFhNGZmOGJiMDg5ZGRlMmQ3OVwiO1xuICBjb25zdCBnZXRDaXR5V2VhdGhlciA9IGFzeW5jIChjaXR5KSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIGBodHRwczovL2FwaS5vcGVud2VhdGhlcm1hcC5vcmcvZGF0YS8yLjUvd2VhdGhlcj9xPSR7Y2l0eX0mYXBwaWQ9JHtBUElLRVl9YFxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBjb25zdCBwYXJzZWRPYmplY3QgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4gcGFyc2VkT2JqZWN0O1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzcG9uc2UpO1xuICB9O1xuICBjb25zdCBnZXRSYW5kb21DaXR5ID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IENJVFlDT1VOVCA9IDUwODA2MTtcbiAgICBjb25zdCByYW5kb21DaXR5SW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBDSVRZQ09VTlQpIC0gMTtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIlgtUmFwaWRBUEktS2V5XCI6IFwiODA3ZWExOGVjMm1zaDNhMjE3NWIyN2NmMDQxZHAxNzBmZWFqc25mNzQ1ZjU1MzZlOTRcIixcbiAgICAgICAgXCJYLVJhcGlkQVBJLUhvc3RcIjogXCJ3ZnQtZ2VvLWRiLnAucmFwaWRhcGkuY29tXCIsXG4gICAgICB9LFxuICAgIH07XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIGBodHRwczovL3dmdC1nZW8tZGIucC5yYXBpZGFwaS5jb20vdjEvZ2VvL2NpdGllcz9saW1pdD0xJmluY2x1ZGVEZWxldGVkPU5PTkUmb2Zmc2V0PSR7cmFuZG9tQ2l0eUluZGV4fWAsXG4gICAgICBvcHRpb25zXG4gICAgKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgIGNvbnN0IHBhcnNlZE9iamVjdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiBwYXJzZWRPYmplY3Q7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXNwb25zZSk7XG4gIH07XG4gIHJldHVybiB7IGdldENpdHlXZWF0aGVyLCBnZXRSYW5kb21DaXR5IH07XG59KSgpO1xuXG5leHBvcnQgeyBBUElSZXF1ZXN0IH07XG4iLCJjb25zdCBmaWx0ZXJEYXRhID0gKCgpID0+IHtcbiAgY29uc3QgZ2V0VGVtcGVyYXR1cmUgPSAoZGF0YSkgPT4gZGF0YS5tYWluLnRlbXA7XG4gIGNvbnN0IGdldFRlbXBlcmF0dXJlRmFocmVuaGVpdCA9IChkYXRhKSA9PiB7XG4gICAgY29uc3Qga2VsdmluID0gZ2V0VGVtcGVyYXR1cmUoZGF0YSk7XG4gICAgY29uc3QgZmFocmVuaGVpdCA9ICgoa2VsdmluIC0gMjczLjE1KSAqIDkpIC8gNSArIDMyO1xuICAgIHJldHVybiBNYXRoLnJvdW5kKGZhaHJlbmhlaXQgKiAxMDApIC8gMTAwO1xuICB9O1xuICBjb25zdCBnZXRUZW1wZXJhdHVyZUNlbHNpdXMgPSAoZGF0YSkgPT4ge1xuICAgIGNvbnN0IGtlbHZpbiA9IGdldFRlbXBlcmF0dXJlKGRhdGEpO1xuICAgIGNvbnN0IGNlbHNpdXMgPSBrZWx2aW4gLSAyNzMuMTU7XG4gICAgcmV0dXJuIE1hdGgucm91bmQoY2Vsc2l1cyAqIDEwMCkgLyAxMDA7XG4gIH07XG4gIGNvbnN0IGdldFdlYXRoZXJNYWluID0gKGRhdGEpID0+IGRhdGEud2VhdGhlclswXS5tYWluO1xuICBjb25zdCBnZXRXZWF0aGVyRGVzY3JpcHRpb24gPSAoZGF0YSkgPT4gZGF0YS53ZWF0aGVyWzBdLmRlc2NyaXB0aW9uO1xuICBjb25zdCBnZXRXZWF0aGVySWNvbkNvZGUgPSAoZGF0YSkgPT4gZGF0YS53ZWF0aGVyWzBdLmljb247XG4gIGNvbnN0IGdldENpdHlOYW1lID0gKGRhdGEpID0+IGRhdGEubmFtZTtcbiAgY29uc3QgZ2V0UmFuZG9tQ2l0eU5hbWUgPSAoZGF0YSkgPT4gZGF0YS5kYXRhWzBdLmNpdHk7XG4gIHJldHVybiB7XG4gICAgZ2V0VGVtcGVyYXR1cmVGYWhyZW5oZWl0LFxuICAgIGdldFRlbXBlcmF0dXJlQ2Vsc2l1cyxcbiAgICBnZXRXZWF0aGVyTWFpbixcbiAgICBnZXRXZWF0aGVyRGVzY3JpcHRpb24sXG4gICAgZ2V0V2VhdGhlckljb25Db2RlLFxuICAgIGdldENpdHlOYW1lLFxuICAgIGdldFJhbmRvbUNpdHlOYW1lLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IHsgZmlsdGVyRGF0YSB9O1xuIiwiaW1wb3J0IHsgZmlsdGVyRGF0YSB9IGZyb20gXCIuL2ZpbHRlcl9kYXRhX21vZHVsZVwiO1xuXG5jb25zdCBET01NYW5pcHVsYXRpb24gPSAoKCkgPT4ge1xuICBsZXQgdGltZXIgPSBmYWxzZTtcbiAgY29uc3QgYWRkV2VhdGhlckljb24gPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBjb25zdCB3ZWF0aGVySWNvbiA9IGZpbHRlckRhdGEuZ2V0V2VhdGhlckljb25Db2RlKHdlYXRoZXJEYXRhKTtcbiAgICBjb25zdCB3ZWF0aGVySWNvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndlYXRoZXItaWNvblwiKTtcbiAgICB3ZWF0aGVySWNvbkVsZW1lbnQuc3JjID0gYGh0dHA6Ly9vcGVud2VhdGhlcm1hcC5vcmcvaW1nL3duLyR7d2VhdGhlckljb259QDR4LnBuZ2A7XG4gIH07XG4gIGNvbnN0IGFkZFdlYXRoZXJNYWluID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3Qgd2VhdGhlck1haW4gPSBmaWx0ZXJEYXRhLmdldFdlYXRoZXJNYWluKHdlYXRoZXJEYXRhKTtcbiAgICBjb25zdCB3ZWF0aGVyTWFpbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndlYXRoZXItbWFpblwiKTtcbiAgICB3ZWF0aGVyTWFpbkVsZW1lbnQudGV4dENvbnRlbnQgPSB3ZWF0aGVyTWFpbjtcbiAgfTtcbiAgY29uc3QgYWRkV2VhdGhlckRlc2NyaXB0aW9uID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3Qgd2VhdGhlckRlc2NyaXB0aW9uID0gZmlsdGVyRGF0YS5nZXRXZWF0aGVyRGVzY3JpcHRpb24od2VhdGhlckRhdGEpO1xuICAgIGNvbnN0IHdlYXRoZXJEZXNjcmlwdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIud2VhdGhlci1kZXNjcmlwdGlvblwiXG4gICAgKTtcbiAgICB3ZWF0aGVyRGVzY3JpcHRpb25FbGVtZW50LnRleHRDb250ZW50ID0gd2VhdGhlckRlc2NyaXB0aW9uO1xuICB9O1xuICBjb25zdCBhZGRUZW1wZXJhdHVyZUZhaHJlbmhlaXQgPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBjb25zdCB0ZW1wRiA9IGZpbHRlckRhdGEuZ2V0VGVtcGVyYXR1cmVGYWhyZW5oZWl0KHdlYXRoZXJEYXRhKTtcbiAgICBjb25zdCB0ZW1wRkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRlbXAtZlwiKTtcbiAgICB0ZW1wRkVsZW1lbnQudGV4dENvbnRlbnQgPSBgJHt0ZW1wRn3CsEZgO1xuICB9O1xuICBjb25zdCBhZGRUZW1wZXJhdHVyZUNlbHNpdXMgPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBjb25zdCB0ZW1wQyA9IGZpbHRlckRhdGEuZ2V0VGVtcGVyYXR1cmVDZWxzaXVzKHdlYXRoZXJEYXRhKTtcbiAgICBjb25zdCB0ZW1wQ0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRlbXAtY1wiKTtcbiAgICB0ZW1wQ0VsZW1lbnQudGV4dENvbnRlbnQgPSBgJHt0ZW1wQ33CsENgO1xuICB9O1xuICBjb25zdCBhZGRDaXR5TmFtZSA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IGNpdHlOYW1lID0gZmlsdGVyRGF0YS5nZXRDaXR5TmFtZSh3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3QgY2l0eU5hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jaXR5LW5hbWVcIik7XG4gICAgY2l0eU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gY2l0eU5hbWU7XG4gIH07XG4gIGNvbnN0IHJlc2V0SW5wdXRWYWx1ZSA9ICgpID0+IHtcbiAgICBjb25zdCBjaXR5SW5wdXRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjaXR5XCIpO1xuICAgIGNpdHlJbnB1dEVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICB9O1xuICBjb25zdCBhZGRQbGFjZWhvbGRlclZhbHVlcyA9ICgpID0+IHtcbiAgICBjb25zdCB3ZWF0aGVySWNvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndlYXRoZXItaWNvblwiKTtcbiAgICBjb25zdCB3ZWF0aGVyTWFpbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndlYXRoZXItbWFpblwiKTtcbiAgICBjb25zdCB3ZWF0aGVyRGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLndlYXRoZXItZGVzY3JpcHRpb25cIlxuICAgICk7XG4gICAgY29uc3QgdGVtcEZFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZW1wLWZcIik7XG4gICAgY29uc3QgdGVtcENFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZW1wLWNcIik7XG4gICAgY29uc3QgY2l0eU5hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jaXR5LW5hbWVcIik7XG4gICAgd2VhdGhlckljb25FbGVtZW50LnNyYyA9IFwiLi4vZGlzdC9taWNrZXkucG5nXCI7XG4gICAgd2VhdGhlck1haW5FbGVtZW50LnRleHRDb250ZW50ID0gXCJUaGUgc3VuIG1pZ2h0IG9yIG1pZ2h0IG5vdCBiZSB2aXNpYmxlXCI7XG4gICAgd2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IFwiaG9wZWZ1bGx5IHRoZSBza3kgaXMgc3RpbGwgYmx1ZVwiO1xuICAgIHRlbXBGRWxlbWVudC50ZXh0Q29udGVudCA9IFwiTGFyZ2VyIG51bWJlcsKwRlwiO1xuICAgIHRlbXBDRWxlbWVudC50ZXh0Q29udGVudCA9IFwiU21hbGxlciBudW1iZXLCsENcIjtcbiAgICBjaXR5TmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcIkRpc25leWxhbmRcIjtcbiAgfTtcbiAgY29uc3QgY2hhbmdlRXJyb3JNZXNzYWdlID0gKG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lcnJvci1tZXNzYWdlXCIpO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuICB9O1xuICBjb25zdCB0b2dnbGVTdWJtaXNzaW9uRWxlbWVudHNFbmFibGVkID0gKCkgPT4ge1xuICAgIGNvbnN0IHN1Ym1pc3Npb25FbGVtZW50cyA9IEFycmF5LmZyb20oXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN1Ym1pc3Npb24tZWxlbWVudFwiKVxuICAgICk7XG4gICAgc3VibWlzc2lvbkVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGlmIChlbGVtZW50LmRpc2FibGVkID09PSBmYWxzZSkge1xuICAgICAgICBlbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgdG9nZ2xlRWxlbWVudERpc3BsYXkgPSAoZWxlbWVudCkgPT4ge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShcIm5vdC1kaXNwbGF5ZWRcIik7XG4gIH07XG4gIGNvbnN0IGNoYW5nZUxvYWRpbmdNZXNzYWdlID0gKG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBsb2FkaW5nTWVzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubG9hZGluZy1tZXNzYWdlXCIpO1xuICAgIGxvYWRpbmdNZXNzYWdlLnRleHRDb250ZW50ID0gbWVzc2FnZTtcbiAgfTtcbiAgY29uc3Qgd2FpdFRpbWVyID0gKGR1cmF0aW9uKSA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNwb25zZSkgPT4gc2V0VGltZW91dChyZXNwb25zZSwgZHVyYXRpb24pKTtcbiAgY29uc3QgdG9nZ2xlTG9hZGluZ01lc3NhZ2VDeWNsZSA9IGFzeW5jIChsb2FkaW5nTWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IGxvYWRpbmdJbmRpY2F0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvYWRpbmctaW5kaWNhdG9yXCIpO1xuICAgIHRpbWVyID8gKHRpbWVyID0gZmFsc2UpIDogKHRpbWVyID0gdHJ1ZSk7XG4gICAgd2hpbGUgKHRpbWVyKSB7XG4gICAgICBjaGFuZ2VMb2FkaW5nTWVzc2FnZShgJHtsb2FkaW5nTWVzc2FnZX0uLi5gKTtcbiAgICAgIGF3YWl0IHdhaXRUaW1lcigxMDAwKTtcbiAgICAgIGlmIChBcnJheS5mcm9tKGxvYWRpbmdJbmRpY2F0b3IuY2xhc3NMaXN0KS5pbmNsdWRlcyhcIm5vdC1kaXNwbGF5ZWRcIikpIHtcbiAgICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9Li4uYCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9LmApO1xuICAgICAgYXdhaXQgd2FpdFRpbWVyKDEwMDApO1xuICAgICAgaWYgKEFycmF5LmZyb20obG9hZGluZ0luZGljYXRvci5jbGFzc0xpc3QpLmluY2x1ZGVzKFwibm90LWRpc3BsYXllZFwiKSkge1xuICAgICAgICBjaGFuZ2VMb2FkaW5nTWVzc2FnZShgJHtsb2FkaW5nTWVzc2FnZX0uLi5gKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjaGFuZ2VMb2FkaW5nTWVzc2FnZShgJHtsb2FkaW5nTWVzc2FnZX0uLmApO1xuICAgICAgYXdhaXQgd2FpdFRpbWVyKDEwMDApO1xuICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9Li4uYCk7XG4gICAgfVxuICB9O1xuICBjb25zdCB0b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyA9IChsb2FkaW5nTWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IGxvYWRpbmdJbmRpY2F0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvYWRpbmctaW5kaWNhdG9yXCIpO1xuICAgIHRvZ2dsZVN1Ym1pc3Npb25FbGVtZW50c0VuYWJsZWQoKTtcbiAgICB0b2dnbGVFbGVtZW50RGlzcGxheShsb2FkaW5nSW5kaWNhdG9yKTtcbiAgICB0b2dnbGVMb2FkaW5nTWVzc2FnZUN5Y2xlKGxvYWRpbmdNZXNzYWdlKTtcbiAgfTtcbiAgY29uc3QgcmVzZXRFcnJvciA9ICgpID0+IHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lcnJvci1tZXNzYWdlXCIpO1xuICAgIGlmICghQXJyYXkuZnJvbShlcnJvck1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdCkuaW5jbHVkZXMoXCJub3QtZGlzcGxheWVkXCIpKSB7XG4gICAgICBlcnJvck1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJub3QtZGlzcGxheWVkXCIpO1xuICAgIH1cbiAgICBjaGFuZ2VFcnJvck1lc3NhZ2UoXCJcIik7XG4gIH07XG4gIGNvbnN0IHVwZGF0ZURpc3BsYXllZFdlYXRoZXIgPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBhZGRXZWF0aGVySWNvbih3ZWF0aGVyRGF0YSk7XG4gICAgYWRkV2VhdGhlck1haW4od2VhdGhlckRhdGEpO1xuICAgIGFkZFdlYXRoZXJEZXNjcmlwdGlvbih3ZWF0aGVyRGF0YSk7XG4gICAgYWRkVGVtcGVyYXR1cmVGYWhyZW5oZWl0KHdlYXRoZXJEYXRhKTtcbiAgICBhZGRUZW1wZXJhdHVyZUNlbHNpdXMod2VhdGhlckRhdGEpO1xuICAgIGFkZENpdHlOYW1lKHdlYXRoZXJEYXRhKTtcbiAgICByZXNldElucHV0VmFsdWUoKTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICB1cGRhdGVEaXNwbGF5ZWRXZWF0aGVyLFxuICAgIGFkZFBsYWNlaG9sZGVyVmFsdWVzLFxuICAgIGNoYW5nZUVycm9yTWVzc2FnZSxcbiAgICB0b2dnbGVFbGVtZW50RGlzcGxheSxcbiAgICB0b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyxcbiAgICByZXNldEVycm9yLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IHsgRE9NTWFuaXB1bGF0aW9uIH07XG4iLCJpbXBvcnQgeyBBUElSZXF1ZXN0IH0gZnJvbSBcIi4vQVBJX3JlcXVlc3RfbW9kdWxlXCI7XG5pbXBvcnQgeyBmaWx0ZXJEYXRhIH0gZnJvbSBcIi4vZmlsdGVyX2RhdGFfbW9kdWxlXCI7XG5pbXBvcnQgeyBET01NYW5pcHVsYXRpb24gfSBmcm9tIFwiLi9ET01fbWFuaXB1bGF0aW9uX21vZHVsZVwiO1xuXG5jb25zdCB1c2VySW5wdXQgPSAoKCkgPT4ge1xuICBjb25zdCBzdWJtaXRVc2VySW5wdXQgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgY2l0eUlucHV0VmFsdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NpdHlcIikudmFsdWU7XG4gICAgaWYgKGNpdHlJbnB1dFZhbHVlICE9PSBcIlwiKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEFQSVJlcXVlc3QuZ2V0Q2l0eVdlYXRoZXIoY2l0eUlucHV0VmFsdWUpO1xuICAgICAgICBET01NYW5pcHVsYXRpb24udXBkYXRlRGlzcGxheWVkV2VhdGhlcihyZXNwb25zZSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgICAvLyBPcGVuV2VhdGhlck1hcCBBUEkgY2FuJ3QgZmluZCB0aGUgY2l0eSBkdWUgdG8gbWlzc3BlbGxpbmcgb3IgbGFjayBvZiBkYXRhXG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICAgIFwiVWggb2gsIGxvb2tzIGxpa2Ugc29tZXRoaW5nIHdlbnQgd3JvbmchIENoZWNrIHlvdXIgc3BlbGxpbmcgb3IgdHJ5IGEgZGlmZmVyZW50IGNpdHkhXCJcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDI5KSB7XG4gICAgICAgICAgLy8gT3BlbldlYXRoZXJNYXAgQVBJIHJhdGUgbGltaXRcbiAgICAgICAgICBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFxuICAgICAgICAgICAgXCJXaG9hLCBzbG93IGRvd24gdGhlcmUgcGFydG5lciEgU2F2ZSBzb21lIHdlYXRoZXIgZGF0YSBmb3IgdGhlIHJlc3Qgb2YgdXMhXCJcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNTAwKSB7XG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICAgIFwiU29tZXRoaW5nIG91dCBvZiBvdXIgY29udHJvbCBpcyBicm9rZW4uIFRyeSBhZ2FpbiBsYXRlciFcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZXJyb3ItbWVzc2FnZVwiKTtcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUVsZW1lbnREaXNwbGF5KGVycm9yTWVzc2FnZUVsZW1lbnQpO1xuICAgICAgICBjb25zb2xlLmVycm9yKEVycm9yKGVycm9yLnN0YXR1c1RleHQpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKCk7XG4gIH07XG4gIGNvbnN0IHN1Ym1pdFJhbmRvbUlucHV0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCByYW5kb21DaXR5TmFtZTtcbiAgICBsZXQgd2VhdGhlclJlc3BvbnNlO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjaXR5UmVzcG9uc2UgPSBhd2FpdCBBUElSZXF1ZXN0LmdldFJhbmRvbUNpdHkoKTtcbiAgICAgIHJhbmRvbUNpdHlOYW1lID0gZmlsdGVyRGF0YS5nZXRSYW5kb21DaXR5TmFtZShjaXR5UmVzcG9uc2UpO1xuICAgICAgd2VhdGhlclJlc3BvbnNlID0gYXdhaXQgQVBJUmVxdWVzdC5nZXRDaXR5V2VhdGhlcihyYW5kb21DaXR5TmFtZSk7XG4gICAgICBET01NYW5pcHVsYXRpb24udXBkYXRlRGlzcGxheWVkV2VhdGhlcih3ZWF0aGVyUmVzcG9uc2UpO1xuICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQwNCAmJiByYW5kb21DaXR5TmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vIEdlb0RCIEFQSSBlcnJvclxuICAgICAgICBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFxuICAgICAgICAgIFwiSG1tLCBpdCBzZWVtcyBsaWtlIHdlJ3JlIHJ1bm5pbmcgaW50byBzb21lIHRyb3VibGUuIFRyeSBhZ2FpbiFcIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgKGVycm9yLnN0YXR1cyA9PT0gNDA0ICYmIHdlYXRoZXJSZXNwb25zZSA9PT0gdW5kZWZpbmVkKSB8fFxuICAgICAgICBlcnJvci5zdGF0dXMgPT09IDQyOVxuICAgICAgKSB7XG4gICAgICAgIC8vIEdlb0RCIGdhdmUgYSBjaXR5IHRoYXQgaGFzIG5vIGRhdGEgaW4gT3BlbldlYXRoZXJNYXAgQVBJXG4gICAgICAgIHNldFRpbWVvdXQoc3VibWl0UmFuZG9tSW5wdXQsIDE1MDApO1xuICAgICAgfSBlbHNlIGlmIChlcnJvci5zdGF0dXMgPT09IDUwMCkge1xuICAgICAgICBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFxuICAgICAgICAgIFwiU29tZXRoaW5nIG91dCBvZiBvdXIgY29udHJvbCBpcyBicm9rZW4uIFRyeSBhZ2FpbiBsYXRlciFcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc29sZS5lcnJvcihFcnJvcihgJHtlcnJvci5zdGF0dXN9ICR7ZXJyb3Iuc3RhdHVzVGV4dH1gKSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBhZGRTZWFyY2hCdXR0b25MaXN0ZW5lciA9ICgpID0+IHtcbiAgICBjb25zdCBzZWFyY2hCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNlYXJjaC1idXR0b25cIik7XG4gICAgc2VhcmNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAvLyBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFwiXCIpLFxuICAgICAgRE9NTWFuaXB1bGF0aW9uLnJlc2V0RXJyb3IoKSxcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKFwiTG9hZGluZ1wiKSxcbiAgICAgICAgc3VibWl0VXNlcklucHV0KCk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGFkZElucHV0RWxlbWVudExpc3RlbmVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGNpdHlJbnB1dEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NpdHlcIik7XG4gICAgY2l0eUlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAvLyBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFwiXCIpLFxuICAgICAgICBET01NYW5pcHVsYXRpb24ucmVzZXRFcnJvcigpLFxuICAgICAgICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyhcIkxvYWRpbmdcIiksXG4gICAgICAgICAgc3VibWl0VXNlcklucHV0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGFkZFJhbmRvbUJ1dHRvbkxpc3RlbmVyID0gKCkgPT4ge1xuICAgIGNvbnN0IHJhbmRvbUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFuZG9tLWJ1dHRvblwiKTtcbiAgICByYW5kb21CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIC8vIERPTU1hbmlwdWxhdGlvbi5jaGFuZ2VFcnJvck1lc3NhZ2UoXCJcIiksXG4gICAgICBET01NYW5pcHVsYXRpb24ucmVzZXRFcnJvcigpLFxuICAgICAgICBET01NYW5pcHVsYXRpb24udG9nZ2xlTG9hZGluZ0luUHJvZ3Jlc3MoXCJSYW5kb21pemluZ1wiKSxcbiAgICAgICAgc3VibWl0UmFuZG9tSW5wdXQoKTtcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgYWRkVGVtcGVyYXR1cmVCdXR0b25MaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgY29uc3QgdGVtcEJ1dHRvbnMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGVtcC1idXR0b25cIikpO1xuICAgIHRlbXBCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRlbXBCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgICAgIERPTU1hbmlwdWxhdGlvbi50b2dnbGVFbGVtZW50RGlzcGxheShidXR0b24pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGRVc2VySW5wdXRMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgYWRkU2VhcmNoQnV0dG9uTGlzdGVuZXIoKTtcbiAgICBhZGRJbnB1dEVsZW1lbnRMaXN0ZW5lcigpO1xuICAgIGFkZFJhbmRvbUJ1dHRvbkxpc3RlbmVyKCk7XG4gICAgYWRkVGVtcGVyYXR1cmVCdXR0b25MaXN0ZW5lcnMoKTtcbiAgfTtcbiAgcmV0dXJuIHsgYWRkVXNlcklucHV0TGlzdGVuZXJzIH07XG59KSgpO1xuXG5leHBvcnQgeyB1c2VySW5wdXQgfTtcbiIsImltcG9ydCB7IEFQSVJlcXVlc3QgfSBmcm9tIFwiLi9BUElfcmVxdWVzdF9tb2R1bGVcIjtcbmltcG9ydCB7IHVzZXJJbnB1dCB9IGZyb20gXCIuL3VzZXJfaW5wdXRfbW9kdWxlXCI7XG5pbXBvcnQgeyBET01NYW5pcHVsYXRpb24gfSBmcm9tIFwiLi9ET01fbWFuaXB1bGF0aW9uX21vZHVsZVwiO1xuXG4oYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZVBhZ2UoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBBUElSZXF1ZXN0LmdldENpdHlXZWF0aGVyKFwiSGVsbFwiKTtcbiAgICBET01NYW5pcHVsYXRpb24udXBkYXRlRGlzcGxheWVkV2VhdGhlcihyZXNwb25zZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgRE9NTWFuaXB1bGF0aW9uLmFkZFBsYWNlaG9sZGVyVmFsdWVzKCk7XG4gICAgY29uc29sZS5lcnJvcihcbiAgICAgIEVycm9yKFxuICAgICAgICBgJHtlcnJvci5zdGF0dXN9ICR7ZXJyb3Iuc3RhdHVzVGV4dH0uIElmIHlvdSBjYW4gc2VlIHRoaXMsIHRoYXQgbWVhbnMgdGhlcmUgd2FzIGFuIGlzc3VlIHdpdGggdGhlIE9wZW5XZWF0aGVyTWFwIEFQSSFgXG4gICAgICApXG4gICAgKTtcbiAgfVxufSkoKTtcblxudXNlcklucHV0LmFkZFVzZXJJbnB1dExpc3RlbmVycygpO1xuIl0sIm5hbWVzIjpbIkFQSVJlcXVlc3QiLCJhc3luYyIsImNpdHkiLCJyZXNwb25zZSIsImZldGNoIiwic3RhdHVzIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJyYW5kb21DaXR5SW5kZXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJtZXRob2QiLCJoZWFkZXJzIiwiZmlsdGVyRGF0YSIsImdldFRlbXBlcmF0dXJlIiwiZGF0YSIsIm1haW4iLCJ0ZW1wIiwiZ2V0VGVtcGVyYXR1cmVGYWhyZW5oZWl0IiwiZmFocmVuaGVpdCIsInJvdW5kIiwiZ2V0VGVtcGVyYXR1cmVDZWxzaXVzIiwiY2Vsc2l1cyIsImdldFdlYXRoZXJNYWluIiwid2VhdGhlciIsImdldFdlYXRoZXJEZXNjcmlwdGlvbiIsImRlc2NyaXB0aW9uIiwiZ2V0V2VhdGhlckljb25Db2RlIiwiaWNvbiIsImdldENpdHlOYW1lIiwibmFtZSIsImdldFJhbmRvbUNpdHlOYW1lIiwiRE9NTWFuaXB1bGF0aW9uIiwidGltZXIiLCJjaGFuZ2VFcnJvck1lc3NhZ2UiLCJtZXNzYWdlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidGV4dENvbnRlbnQiLCJ0b2dnbGVFbGVtZW50RGlzcGxheSIsImVsZW1lbnQiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJjaGFuZ2VMb2FkaW5nTWVzc2FnZSIsIndhaXRUaW1lciIsImR1cmF0aW9uIiwic2V0VGltZW91dCIsInVwZGF0ZURpc3BsYXllZFdlYXRoZXIiLCJ3ZWF0aGVyRGF0YSIsIndlYXRoZXJJY29uIiwic3JjIiwiYWRkV2VhdGhlckljb24iLCJ3ZWF0aGVyTWFpbiIsImFkZFdlYXRoZXJNYWluIiwid2VhdGhlckRlc2NyaXB0aW9uIiwiYWRkV2VhdGhlckRlc2NyaXB0aW9uIiwidGVtcEYiLCJhZGRUZW1wZXJhdHVyZUZhaHJlbmhlaXQiLCJ0ZW1wQyIsImFkZFRlbXBlcmF0dXJlQ2Vsc2l1cyIsImNpdHlOYW1lIiwiYWRkQ2l0eU5hbWUiLCJ2YWx1ZSIsImFkZFBsYWNlaG9sZGVyVmFsdWVzIiwid2VhdGhlckljb25FbGVtZW50Iiwid2VhdGhlck1haW5FbGVtZW50Iiwid2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudCIsInRlbXBGRWxlbWVudCIsInRlbXBDRWxlbWVudCIsImNpdHlOYW1lRWxlbWVudCIsInRvZ2dsZUxvYWRpbmdJblByb2dyZXNzIiwibG9hZGluZ01lc3NhZ2UiLCJsb2FkaW5nSW5kaWNhdG9yIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJkaXNhYmxlZCIsImluY2x1ZGVzIiwidG9nZ2xlTG9hZGluZ01lc3NhZ2VDeWNsZSIsInJlc2V0RXJyb3IiLCJlcnJvck1lc3NhZ2VFbGVtZW50IiwiYWRkIiwidXNlcklucHV0Iiwic3VibWl0VXNlcklucHV0IiwiY2l0eUlucHV0VmFsdWUiLCJlcnJvciIsImNvbnNvbGUiLCJFcnJvciIsInN0YXR1c1RleHQiLCJzdWJtaXRSYW5kb21JbnB1dCIsInJhbmRvbUNpdHlOYW1lIiwid2VhdGhlclJlc3BvbnNlIiwiY2l0eVJlc3BvbnNlIiwidW5kZWZpbmVkIiwiYWRkVXNlcklucHV0TGlzdGVuZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwia2V5IiwidGVtcEJ1dHRvbnMiLCJidXR0b24iLCJhZGRUZW1wZXJhdHVyZUJ1dHRvbkxpc3RlbmVycyJdLCJzb3VyY2VSb290IjoiIn0=