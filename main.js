(()=>{"use strict";const e=async e=>{const t=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${e}&appid=a0c9839361f301aa4ff8bb089dde2d79`);return 200===t.status?await t.json():Promise.reject(t)},t=async()=>{const e=Math.floor(508061*Math.random())-1,t=await fetch(`https://wft-geo-db.p.rapidapi.com/v1/geo/cities?limit=1&includeDeleted=NONE&offset=${e}`,{method:"GET",headers:{"X-RapidAPI-Key":"807ea18ec2msh3a2175b27cf041dp170feajsnf745f5536e94","X-RapidAPI-Host":"wft-geo-db.p.rapidapi.com"}});return 200===t.status?await t.json():Promise.reject(t)},r=(()=>{const e=e=>e.main.temp;return{getTemperatureFahrenheit:t=>{const r=9*(e(t)-273.15)/5+32;return Math.round(100*r)/100},getTemperatureCelsius:t=>{const r=e(t)-273.15;return Math.round(100*r)/100},getWeatherMain:e=>e.weather[0].main,getWeatherDescription:e=>e.weather[0].description,getWeatherIconCode:e=>e.weather[0].icon,getCityName:e=>e.name,getRandomCityName:e=>e.data[0].city,getCountryName:e=>{const t=(e=>e.sys.country)(e);return new Intl.DisplayNames(["en"],{type:"region"}).of(`${t}`)}}})(),o=(()=>{let e=!1;const t=e=>{e.classList.toggle("not-displayed")},o=e=>{document.querySelector(".loading-message").textContent=e},n=e=>new Promise((t=>setTimeout(t,e)));return{updateDisplayedWeather:e=>{(e=>{const t=r.getWeatherIconCode(e);document.querySelector(".weather-icon").src=`http://openweathermap.org/img/wn/${t}@4x.png`})(e),(e=>{const t=r.getWeatherMain(e);document.querySelector(".weather-main").textContent=t})(e),(e=>{const t=r.getWeatherDescription(e);document.querySelector(".weather-description").textContent=t})(e),(e=>{const t=r.getTemperatureFahrenheit(e);document.querySelector(".temp-f").textContent=`${t}째F`})(e),(e=>{const t=r.getTemperatureCelsius(e);document.querySelector(".temp-c").textContent=`${t}째C`})(e),(e=>{const t=r.getCityName(e);document.querySelector(".city-name").textContent=t})(e),(e=>{const t=r.getCountryName(e);document.querySelector(".country-name").textContent=t})(e),document.querySelector("#city").value=""},addPlaceholderValues:()=>{const e=document.querySelector(".weather-icon"),t=document.querySelector(".weather-main"),r=document.querySelector(".weather-description"),o=document.querySelector(".temp-f"),n=document.querySelector(".temp-c"),a=document.querySelector(".city-name");e.src="../dist/mickey.png",t.textContent="The sun might or might not be visible",r.textContent="hopefully the sky is still blue",o.textContent="Larger number째F",n.textContent="Smaller number째C",a.textContent="Disneyland"},changeErrorMessage:e=>{document.querySelector(".error-message").textContent=e},toggleElementDisplay:t,toggleLoadingInProgress:r=>{const a=document.querySelector("#loading-indicator");Array.from(document.querySelectorAll(".submission-element")).forEach((e=>{!1===e.disabled?e.disabled=!0:e.disabled=!1})),t(a),(async t=>{const r=document.querySelector("#loading-indicator");for(e=!e;e;){if(o(`${t}...`),await n(1e3),Array.from(r.classList).includes("not-displayed")){o(`${t}...`);break}if(o(`${t}.`),await n(1e3),Array.from(r.classList).includes("not-displayed")){o(`${t}...`);break}o(`${t}..`),await n(1e3),o(`${t}...`)}})(r)},resetError:()=>{const e=document.querySelector(".error-message");Array.from(e.classList).includes("not-displayed")||e.classList.add("not-displayed")}}})(),n=(()=>{const n=async()=>{const t=document.querySelector("#city").value;if(""!==t)try{const r=await e(t);o.updateDisplayedWeather(r)}catch(e){404===e.status?o.changeErrorMessage("Uh oh, looks like something went wrong! Check your spelling or try a different city!"):429===e.status?o.changeErrorMessage("Whoa, slow down there partner! Save some weather data for the rest of us!"):500===e.status&&o.changeErrorMessage("Something out of our control is broken. Try again later!");const t=document.querySelector(".error-message");o.toggleElementDisplay(t),console.error(Error(e.statusText))}o.toggleLoadingInProgress()},a=async()=>{let n,s;try{const a=await t();n=r.getRandomCityName(a),s=await e(n),o.updateDisplayedWeather(s),o.toggleLoadingInProgress()}catch(e){404===e.status&&void 0===n?o.changeErrorMessage("Hmm, it seems like we're running into some trouble. Try again!"):404===e.status&&void 0===s||429===e.status?setTimeout(a,1500):500===e.status&&o.changeErrorMessage("Something out of our control is broken. Try again later!"),console.error(Error(`${e.status} ${e.statusText}`))}};return{addUserInputListeners:()=>{document.querySelector(".search-button").addEventListener("click",(()=>{o.resetError(),o.toggleLoadingInProgress("Loading"),n()})),document.querySelector("#city").addEventListener("keydown",(e=>{"Enter"===e.key&&(o.resetError(),o.toggleLoadingInProgress("Loading"),n())})),document.querySelector(".random-button").addEventListener("click",(()=>{o.resetError(),o.toggleLoadingInProgress("Randomizing"),a()})),(()=>{const e=Array.from(document.querySelectorAll(".temp-button"));e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{o.toggleElementDisplay(e)}))}))}))})()}}})();!async function(){try{const t=await e("Hell");o.updateDisplayedWeather(t)}catch(e){o.addPlaceholderValues(),console.error(Error(`${e.status} ${e.statusText}. If you can see this, that means there was an issue with the OpenWeatherMap API!`))}}(),n.addUserInputListeners()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Oi8vb2Rpbi13ZWF0aGVyLWFwcC8uL3NyYy9BUElfcmVxdWVzdF9tb2R1bGUuanMiLCJ3ZWJwYWNrOi8vb2Rpbi13ZWF0aGVyLWFwcC8uL3NyYy9maWx0ZXJfZGF0YV9tb2R1bGUuanMiLCJ3ZWJwYWNrOi8vb2Rpbi13ZWF0aGVyLWFwcC8uL3NyYy9ET01fbWFuaXB1bGF0aW9uX21vZHVsZS5qcyIsIndlYnBhY2s6Ly9vZGluLXdlYXRoZXItYXBwLy4vc3JjL3VzZXJfaW5wdXRfbW9kdWxlLmpzIiwid2VicGFjazovL29kaW4td2VhdGhlci1hcHAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQVBJUmVxdWVzdCA9ICgoKSA9PiB7XG4gIGNvbnN0IEFQSUtFWSA9IFwiYTBjOTgzOTM2MWYzMDFhYTRmZjhiYjA4OWRkZTJkNzlcIjtcbiAgY29uc3QgZ2V0Q2l0eVdlYXRoZXIgPSBhc3luYyAoY2l0eSkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICBgaHR0cHM6Ly9hcGkub3BlbndlYXRoZXJtYXAub3JnL2RhdGEvMi41L3dlYXRoZXI/cT0ke2NpdHl9JmFwcGlkPSR7QVBJS0VZfWBcbiAgICApO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgY29uc3QgcGFyc2VkT2JqZWN0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIHBhcnNlZE9iamVjdDtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlKTtcbiAgfTtcbiAgY29uc3QgZ2V0UmFuZG9tQ2l0eSA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBDSVRZQ09VTlQgPSA1MDgwNjE7XG4gICAgY29uc3QgcmFuZG9tQ2l0eUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogQ0lUWUNPVU5UKSAtIDE7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJYLVJhcGlkQVBJLUtleVwiOiBcIjgwN2VhMThlYzJtc2gzYTIxNzViMjdjZjA0MWRwMTcwZmVhanNuZjc0NWY1NTM2ZTk0XCIsXG4gICAgICAgIFwiWC1SYXBpZEFQSS1Ib3N0XCI6IFwid2Z0LWdlby1kYi5wLnJhcGlkYXBpLmNvbVwiLFxuICAgICAgfSxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICBgaHR0cHM6Ly93ZnQtZ2VvLWRiLnAucmFwaWRhcGkuY29tL3YxL2dlby9jaXRpZXM/bGltaXQ9MSZpbmNsdWRlRGVsZXRlZD1OT05FJm9mZnNldD0ke3JhbmRvbUNpdHlJbmRleH1gLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBjb25zdCBwYXJzZWRPYmplY3QgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4gcGFyc2VkT2JqZWN0O1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzcG9uc2UpO1xuICB9O1xuICByZXR1cm4geyBnZXRDaXR5V2VhdGhlciwgZ2V0UmFuZG9tQ2l0eSB9O1xufSkoKTtcblxuZXhwb3J0IHsgQVBJUmVxdWVzdCB9O1xuIiwiY29uc3QgZmlsdGVyRGF0YSA9ICgoKSA9PiB7XG4gIGNvbnN0IGdldFRlbXBlcmF0dXJlID0gKGRhdGEpID0+IGRhdGEubWFpbi50ZW1wO1xuICBjb25zdCBnZXRUZW1wZXJhdHVyZUZhaHJlbmhlaXQgPSAoZGF0YSkgPT4ge1xuICAgIGNvbnN0IGtlbHZpbiA9IGdldFRlbXBlcmF0dXJlKGRhdGEpO1xuICAgIGNvbnN0IGZhaHJlbmhlaXQgPSAoKGtlbHZpbiAtIDI3My4xNSkgKiA5KSAvIDUgKyAzMjtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChmYWhyZW5oZWl0ICogMTAwKSAvIDEwMDtcbiAgfTtcbiAgY29uc3QgZ2V0VGVtcGVyYXR1cmVDZWxzaXVzID0gKGRhdGEpID0+IHtcbiAgICBjb25zdCBrZWx2aW4gPSBnZXRUZW1wZXJhdHVyZShkYXRhKTtcbiAgICBjb25zdCBjZWxzaXVzID0ga2VsdmluIC0gMjczLjE1O1xuICAgIHJldHVybiBNYXRoLnJvdW5kKGNlbHNpdXMgKiAxMDApIC8gMTAwO1xuICB9O1xuICBjb25zdCBnZXRXZWF0aGVyTWFpbiA9IChkYXRhKSA9PiBkYXRhLndlYXRoZXJbMF0ubWFpbjtcbiAgY29uc3QgZ2V0V2VhdGhlckRlc2NyaXB0aW9uID0gKGRhdGEpID0+IGRhdGEud2VhdGhlclswXS5kZXNjcmlwdGlvbjtcbiAgY29uc3QgZ2V0V2VhdGhlckljb25Db2RlID0gKGRhdGEpID0+IGRhdGEud2VhdGhlclswXS5pY29uO1xuICBjb25zdCBnZXRDaXR5TmFtZSA9IChkYXRhKSA9PiBkYXRhLm5hbWU7XG4gIGNvbnN0IGdldENvdW50cnlDb2RlID0gKGRhdGEpID0+IGRhdGEuc3lzLmNvdW50cnk7XG4gIGNvbnN0IGdldENvdW50cnlOYW1lID0gKGRhdGEpID0+IHtcbiAgICBjb25zdCBjb3VudHJ5Q29kZSA9IGdldENvdW50cnlDb2RlKGRhdGEpO1xuICAgIGNvbnN0IHJlZ2lvbk5hbWVzID0gbmV3IEludGwuRGlzcGxheU5hbWVzKFtcImVuXCJdLCB7IHR5cGU6IFwicmVnaW9uXCIgfSk7XG4gICAgY29uc3QgY291bnRyeU5hbWUgPSByZWdpb25OYW1lcy5vZihgJHtjb3VudHJ5Q29kZX1gKTtcbiAgICByZXR1cm4gY291bnRyeU5hbWU7XG4gIH07XG4gIGNvbnN0IGdldFJhbmRvbUNpdHlOYW1lID0gKGRhdGEpID0+IGRhdGEuZGF0YVswXS5jaXR5O1xuICByZXR1cm4ge1xuICAgIGdldFRlbXBlcmF0dXJlRmFocmVuaGVpdCxcbiAgICBnZXRUZW1wZXJhdHVyZUNlbHNpdXMsXG4gICAgZ2V0V2VhdGhlck1haW4sXG4gICAgZ2V0V2VhdGhlckRlc2NyaXB0aW9uLFxuICAgIGdldFdlYXRoZXJJY29uQ29kZSxcbiAgICBnZXRDaXR5TmFtZSxcbiAgICBnZXRSYW5kb21DaXR5TmFtZSxcbiAgICBnZXRDb3VudHJ5TmFtZSxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IGZpbHRlckRhdGEgfTtcbiIsImltcG9ydCB7IGZpbHRlckRhdGEgfSBmcm9tIFwiLi9maWx0ZXJfZGF0YV9tb2R1bGVcIjtcblxuY29uc3QgRE9NTWFuaXB1bGF0aW9uID0gKCgpID0+IHtcbiAgbGV0IHRpbWVyID0gZmFsc2U7XG4gIGNvbnN0IGFkZFdlYXRoZXJJY29uID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3Qgd2VhdGhlckljb24gPSBmaWx0ZXJEYXRhLmdldFdlYXRoZXJJY29uQ29kZSh3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3Qgd2VhdGhlckljb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWF0aGVyLWljb25cIik7XG4gICAgd2VhdGhlckljb25FbGVtZW50LnNyYyA9IGBodHRwOi8vb3BlbndlYXRoZXJtYXAub3JnL2ltZy93bi8ke3dlYXRoZXJJY29ufUA0eC5wbmdgO1xuICB9O1xuICBjb25zdCBhZGRXZWF0aGVyTWFpbiA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IHdlYXRoZXJNYWluID0gZmlsdGVyRGF0YS5nZXRXZWF0aGVyTWFpbih3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3Qgd2VhdGhlck1haW5FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53ZWF0aGVyLW1haW5cIik7XG4gICAgd2VhdGhlck1haW5FbGVtZW50LnRleHRDb250ZW50ID0gd2VhdGhlck1haW47XG4gIH07XG4gIGNvbnN0IGFkZFdlYXRoZXJEZXNjcmlwdGlvbiA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IHdlYXRoZXJEZXNjcmlwdGlvbiA9IGZpbHRlckRhdGEuZ2V0V2VhdGhlckRlc2NyaXB0aW9uKHdlYXRoZXJEYXRhKTtcbiAgICBjb25zdCB3ZWF0aGVyRGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLndlYXRoZXItZGVzY3JpcHRpb25cIlxuICAgICk7XG4gICAgd2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IHdlYXRoZXJEZXNjcmlwdGlvbjtcbiAgfTtcbiAgY29uc3QgYWRkVGVtcGVyYXR1cmVGYWhyZW5oZWl0ID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3QgdGVtcEYgPSBmaWx0ZXJEYXRhLmdldFRlbXBlcmF0dXJlRmFocmVuaGVpdCh3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3QgdGVtcEZFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZW1wLWZcIik7XG4gICAgdGVtcEZFbGVtZW50LnRleHRDb250ZW50ID0gYCR7dGVtcEZ9wrBGYDtcbiAgfTtcbiAgY29uc3QgYWRkVGVtcGVyYXR1cmVDZWxzaXVzID0gKHdlYXRoZXJEYXRhKSA9PiB7XG4gICAgY29uc3QgdGVtcEMgPSBmaWx0ZXJEYXRhLmdldFRlbXBlcmF0dXJlQ2Vsc2l1cyh3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3QgdGVtcENFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZW1wLWNcIik7XG4gICAgdGVtcENFbGVtZW50LnRleHRDb250ZW50ID0gYCR7dGVtcEN9wrBDYDtcbiAgfTtcbiAgY29uc3QgYWRkQ2l0eU5hbWUgPSAod2VhdGhlckRhdGEpID0+IHtcbiAgICBjb25zdCBjaXR5TmFtZSA9IGZpbHRlckRhdGEuZ2V0Q2l0eU5hbWUod2VhdGhlckRhdGEpO1xuICAgIGNvbnN0IGNpdHlOYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2l0eS1uYW1lXCIpO1xuICAgIGNpdHlOYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGNpdHlOYW1lO1xuICB9O1xuICBjb25zdCBhZGRDb3VudHJ5TmFtZSA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGNvbnN0IGNvdW50cnlOYW1lID0gZmlsdGVyRGF0YS5nZXRDb3VudHJ5TmFtZSh3ZWF0aGVyRGF0YSk7XG4gICAgY29uc3QgY291bnRyeU5hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jb3VudHJ5LW5hbWVcIik7XG4gICAgY291bnRyeU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gY291bnRyeU5hbWU7XG4gIH07XG4gIGNvbnN0IHJlc2V0SW5wdXRWYWx1ZSA9ICgpID0+IHtcbiAgICBjb25zdCBjaXR5SW5wdXRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjaXR5XCIpO1xuICAgIGNpdHlJbnB1dEVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICB9O1xuICBjb25zdCBhZGRQbGFjZWhvbGRlclZhbHVlcyA9ICgpID0+IHtcbiAgICBjb25zdCB3ZWF0aGVySWNvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndlYXRoZXItaWNvblwiKTtcbiAgICBjb25zdCB3ZWF0aGVyTWFpbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndlYXRoZXItbWFpblwiKTtcbiAgICBjb25zdCB3ZWF0aGVyRGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLndlYXRoZXItZGVzY3JpcHRpb25cIlxuICAgICk7XG4gICAgY29uc3QgdGVtcEZFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZW1wLWZcIik7XG4gICAgY29uc3QgdGVtcENFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZW1wLWNcIik7XG4gICAgY29uc3QgY2l0eU5hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jaXR5LW5hbWVcIik7XG4gICAgd2VhdGhlckljb25FbGVtZW50LnNyYyA9IFwiLi4vZGlzdC9taWNrZXkucG5nXCI7XG4gICAgd2VhdGhlck1haW5FbGVtZW50LnRleHRDb250ZW50ID0gXCJUaGUgc3VuIG1pZ2h0IG9yIG1pZ2h0IG5vdCBiZSB2aXNpYmxlXCI7XG4gICAgd2VhdGhlckRlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IFwiaG9wZWZ1bGx5IHRoZSBza3kgaXMgc3RpbGwgYmx1ZVwiO1xuICAgIHRlbXBGRWxlbWVudC50ZXh0Q29udGVudCA9IFwiTGFyZ2VyIG51bWJlcsKwRlwiO1xuICAgIHRlbXBDRWxlbWVudC50ZXh0Q29udGVudCA9IFwiU21hbGxlciBudW1iZXLCsENcIjtcbiAgICBjaXR5TmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcIkRpc25leWxhbmRcIjtcbiAgfTtcbiAgY29uc3QgY2hhbmdlRXJyb3JNZXNzYWdlID0gKG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lcnJvci1tZXNzYWdlXCIpO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuICB9O1xuICBjb25zdCB0b2dnbGVTdWJtaXNzaW9uRWxlbWVudHNFbmFibGVkID0gKCkgPT4ge1xuICAgIGNvbnN0IHN1Ym1pc3Npb25FbGVtZW50cyA9IEFycmF5LmZyb20oXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN1Ym1pc3Npb24tZWxlbWVudFwiKVxuICAgICk7XG4gICAgc3VibWlzc2lvbkVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGlmIChlbGVtZW50LmRpc2FibGVkID09PSBmYWxzZSkge1xuICAgICAgICBlbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgdG9nZ2xlRWxlbWVudERpc3BsYXkgPSAoZWxlbWVudCkgPT4ge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShcIm5vdC1kaXNwbGF5ZWRcIik7XG4gIH07XG4gIGNvbnN0IGNoYW5nZUxvYWRpbmdNZXNzYWdlID0gKG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBsb2FkaW5nTWVzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubG9hZGluZy1tZXNzYWdlXCIpO1xuICAgIGxvYWRpbmdNZXNzYWdlLnRleHRDb250ZW50ID0gbWVzc2FnZTtcbiAgfTtcbiAgY29uc3Qgd2FpdFRpbWVyID0gKGR1cmF0aW9uKSA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNwb25zZSkgPT4gc2V0VGltZW91dChyZXNwb25zZSwgZHVyYXRpb24pKTtcbiAgY29uc3QgdG9nZ2xlTG9hZGluZ01lc3NhZ2VDeWNsZSA9IGFzeW5jIChsb2FkaW5nTWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IGxvYWRpbmdJbmRpY2F0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvYWRpbmctaW5kaWNhdG9yXCIpO1xuICAgIHRpbWVyID8gKHRpbWVyID0gZmFsc2UpIDogKHRpbWVyID0gdHJ1ZSk7XG4gICAgd2hpbGUgKHRpbWVyKSB7XG4gICAgICBjaGFuZ2VMb2FkaW5nTWVzc2FnZShgJHtsb2FkaW5nTWVzc2FnZX0uLi5gKTtcbiAgICAgIGF3YWl0IHdhaXRUaW1lcigxMDAwKTtcbiAgICAgIGlmIChBcnJheS5mcm9tKGxvYWRpbmdJbmRpY2F0b3IuY2xhc3NMaXN0KS5pbmNsdWRlcyhcIm5vdC1kaXNwbGF5ZWRcIikpIHtcbiAgICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9Li4uYCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9LmApO1xuICAgICAgYXdhaXQgd2FpdFRpbWVyKDEwMDApO1xuICAgICAgaWYgKEFycmF5LmZyb20obG9hZGluZ0luZGljYXRvci5jbGFzc0xpc3QpLmluY2x1ZGVzKFwibm90LWRpc3BsYXllZFwiKSkge1xuICAgICAgICBjaGFuZ2VMb2FkaW5nTWVzc2FnZShgJHtsb2FkaW5nTWVzc2FnZX0uLi5gKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjaGFuZ2VMb2FkaW5nTWVzc2FnZShgJHtsb2FkaW5nTWVzc2FnZX0uLmApO1xuICAgICAgYXdhaXQgd2FpdFRpbWVyKDEwMDApO1xuICAgICAgY2hhbmdlTG9hZGluZ01lc3NhZ2UoYCR7bG9hZGluZ01lc3NhZ2V9Li4uYCk7XG4gICAgfVxuICB9O1xuICBjb25zdCB0b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyA9IChsb2FkaW5nTWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IGxvYWRpbmdJbmRpY2F0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvYWRpbmctaW5kaWNhdG9yXCIpO1xuICAgIHRvZ2dsZVN1Ym1pc3Npb25FbGVtZW50c0VuYWJsZWQoKTtcbiAgICB0b2dnbGVFbGVtZW50RGlzcGxheShsb2FkaW5nSW5kaWNhdG9yKTtcbiAgICB0b2dnbGVMb2FkaW5nTWVzc2FnZUN5Y2xlKGxvYWRpbmdNZXNzYWdlKTtcbiAgfTtcbiAgY29uc3QgcmVzZXRFcnJvciA9ICgpID0+IHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lcnJvci1tZXNzYWdlXCIpO1xuICAgIGlmICghQXJyYXkuZnJvbShlcnJvck1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdCkuaW5jbHVkZXMoXCJub3QtZGlzcGxheWVkXCIpKSB7XG4gICAgICBlcnJvck1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJub3QtZGlzcGxheWVkXCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgdXBkYXRlRGlzcGxheWVkV2VhdGhlciA9ICh3ZWF0aGVyRGF0YSkgPT4ge1xuICAgIGFkZFdlYXRoZXJJY29uKHdlYXRoZXJEYXRhKTtcbiAgICBhZGRXZWF0aGVyTWFpbih3ZWF0aGVyRGF0YSk7XG4gICAgYWRkV2VhdGhlckRlc2NyaXB0aW9uKHdlYXRoZXJEYXRhKTtcbiAgICBhZGRUZW1wZXJhdHVyZUZhaHJlbmhlaXQod2VhdGhlckRhdGEpO1xuICAgIGFkZFRlbXBlcmF0dXJlQ2Vsc2l1cyh3ZWF0aGVyRGF0YSk7XG4gICAgYWRkQ2l0eU5hbWUod2VhdGhlckRhdGEpO1xuICAgIGFkZENvdW50cnlOYW1lKHdlYXRoZXJEYXRhKTtcbiAgICByZXNldElucHV0VmFsdWUoKTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICB1cGRhdGVEaXNwbGF5ZWRXZWF0aGVyLFxuICAgIGFkZFBsYWNlaG9sZGVyVmFsdWVzLFxuICAgIGNoYW5nZUVycm9yTWVzc2FnZSxcbiAgICB0b2dnbGVFbGVtZW50RGlzcGxheSxcbiAgICB0b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyxcbiAgICByZXNldEVycm9yLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IHsgRE9NTWFuaXB1bGF0aW9uIH07XG4iLCJpbXBvcnQgeyBBUElSZXF1ZXN0IH0gZnJvbSBcIi4vQVBJX3JlcXVlc3RfbW9kdWxlXCI7XG5pbXBvcnQgeyBmaWx0ZXJEYXRhIH0gZnJvbSBcIi4vZmlsdGVyX2RhdGFfbW9kdWxlXCI7XG5pbXBvcnQgeyBET01NYW5pcHVsYXRpb24gfSBmcm9tIFwiLi9ET01fbWFuaXB1bGF0aW9uX21vZHVsZVwiO1xuXG5jb25zdCB1c2VySW5wdXQgPSAoKCkgPT4ge1xuICBjb25zdCBzdWJtaXRVc2VySW5wdXQgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgY2l0eUlucHV0VmFsdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NpdHlcIikudmFsdWU7XG4gICAgaWYgKGNpdHlJbnB1dFZhbHVlICE9PSBcIlwiKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEFQSVJlcXVlc3QuZ2V0Q2l0eVdlYXRoZXIoY2l0eUlucHV0VmFsdWUpO1xuICAgICAgICBET01NYW5pcHVsYXRpb24udXBkYXRlRGlzcGxheWVkV2VhdGhlcihyZXNwb25zZSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgICAvLyBPcGVuV2VhdGhlck1hcCBBUEkgY2FuJ3QgZmluZCB0aGUgY2l0eSBkdWUgdG8gbWlzc3BlbGxpbmcgb3IgbGFjayBvZiBkYXRhXG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICAgIFwiVWggb2gsIGxvb2tzIGxpa2Ugc29tZXRoaW5nIHdlbnQgd3JvbmchIENoZWNrIHlvdXIgc3BlbGxpbmcgb3IgdHJ5IGEgZGlmZmVyZW50IGNpdHkhXCJcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDI5KSB7XG4gICAgICAgICAgLy8gT3BlbldlYXRoZXJNYXAgQVBJIHJhdGUgbGltaXRcbiAgICAgICAgICBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFxuICAgICAgICAgICAgXCJXaG9hLCBzbG93IGRvd24gdGhlcmUgcGFydG5lciEgU2F2ZSBzb21lIHdlYXRoZXIgZGF0YSBmb3IgdGhlIHJlc3Qgb2YgdXMhXCJcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNTAwKSB7XG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLmNoYW5nZUVycm9yTWVzc2FnZShcbiAgICAgICAgICAgIFwiU29tZXRoaW5nIG91dCBvZiBvdXIgY29udHJvbCBpcyBicm9rZW4uIFRyeSBhZ2FpbiBsYXRlciFcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZXJyb3ItbWVzc2FnZVwiKTtcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUVsZW1lbnREaXNwbGF5KGVycm9yTWVzc2FnZUVsZW1lbnQpO1xuICAgICAgICBjb25zb2xlLmVycm9yKEVycm9yKGVycm9yLnN0YXR1c1RleHQpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKCk7XG4gIH07XG4gIGNvbnN0IHN1Ym1pdFJhbmRvbUlucHV0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCByYW5kb21DaXR5TmFtZTtcbiAgICBsZXQgd2VhdGhlclJlc3BvbnNlO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjaXR5UmVzcG9uc2UgPSBhd2FpdCBBUElSZXF1ZXN0LmdldFJhbmRvbUNpdHkoKTtcbiAgICAgIHJhbmRvbUNpdHlOYW1lID0gZmlsdGVyRGF0YS5nZXRSYW5kb21DaXR5TmFtZShjaXR5UmVzcG9uc2UpO1xuICAgICAgd2VhdGhlclJlc3BvbnNlID0gYXdhaXQgQVBJUmVxdWVzdC5nZXRDaXR5V2VhdGhlcihyYW5kb21DaXR5TmFtZSk7XG4gICAgICBET01NYW5pcHVsYXRpb24udXBkYXRlRGlzcGxheWVkV2VhdGhlcih3ZWF0aGVyUmVzcG9uc2UpO1xuICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQwNCAmJiByYW5kb21DaXR5TmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vIEdlb0RCIEFQSSBlcnJvclxuICAgICAgICBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFxuICAgICAgICAgIFwiSG1tLCBpdCBzZWVtcyBsaWtlIHdlJ3JlIHJ1bm5pbmcgaW50byBzb21lIHRyb3VibGUuIFRyeSBhZ2FpbiFcIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgKGVycm9yLnN0YXR1cyA9PT0gNDA0ICYmIHdlYXRoZXJSZXNwb25zZSA9PT0gdW5kZWZpbmVkKSB8fFxuICAgICAgICBlcnJvci5zdGF0dXMgPT09IDQyOVxuICAgICAgKSB7XG4gICAgICAgIC8vIEdlb0RCIGdhdmUgYSBjaXR5IHRoYXQgaGFzIG5vIGRhdGEgaW4gT3BlbldlYXRoZXJNYXAgQVBJXG4gICAgICAgIHNldFRpbWVvdXQoc3VibWl0UmFuZG9tSW5wdXQsIDE1MDApO1xuICAgICAgfSBlbHNlIGlmIChlcnJvci5zdGF0dXMgPT09IDUwMCkge1xuICAgICAgICBET01NYW5pcHVsYXRpb24uY2hhbmdlRXJyb3JNZXNzYWdlKFxuICAgICAgICAgIFwiU29tZXRoaW5nIG91dCBvZiBvdXIgY29udHJvbCBpcyBicm9rZW4uIFRyeSBhZ2FpbiBsYXRlciFcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc29sZS5lcnJvcihFcnJvcihgJHtlcnJvci5zdGF0dXN9ICR7ZXJyb3Iuc3RhdHVzVGV4dH1gKSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBhZGRTZWFyY2hCdXR0b25MaXN0ZW5lciA9ICgpID0+IHtcbiAgICBjb25zdCBzZWFyY2hCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNlYXJjaC1idXR0b25cIik7XG4gICAgc2VhcmNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBET01NYW5pcHVsYXRpb24ucmVzZXRFcnJvcigpLFxuICAgICAgICBET01NYW5pcHVsYXRpb24udG9nZ2xlTG9hZGluZ0luUHJvZ3Jlc3MoXCJMb2FkaW5nXCIpLFxuICAgICAgICBzdWJtaXRVc2VySW5wdXQoKTtcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgYWRkSW5wdXRFbGVtZW50TGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgY2l0eUlucHV0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2l0eVwiKTtcbiAgICBjaXR5SW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgIERPTU1hbmlwdWxhdGlvbi5yZXNldEVycm9yKCksXG4gICAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKFwiTG9hZGluZ1wiKSxcbiAgICAgICAgICBzdWJtaXRVc2VySW5wdXQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgYWRkUmFuZG9tQnV0dG9uTGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgcmFuZG9tQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yYW5kb20tYnV0dG9uXCIpO1xuICAgIHJhbmRvbUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgRE9NTWFuaXB1bGF0aW9uLnJlc2V0RXJyb3IoKSxcbiAgICAgICAgRE9NTWFuaXB1bGF0aW9uLnRvZ2dsZUxvYWRpbmdJblByb2dyZXNzKFwiUmFuZG9taXppbmdcIiksXG4gICAgICAgIHN1Ym1pdFJhbmRvbUlucHV0KCk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGFkZFRlbXBlcmF0dXJlQnV0dG9uTGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIGNvbnN0IHRlbXBCdXR0b25zID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRlbXAtYnV0dG9uXCIpKTtcbiAgICB0ZW1wQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICB0ZW1wQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgICAgICAgICBET01NYW5pcHVsYXRpb24udG9nZ2xlRWxlbWVudERpc3BsYXkoYnV0dG9uKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgYWRkVXNlcklucHV0TGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIGFkZFNlYXJjaEJ1dHRvbkxpc3RlbmVyKCk7XG4gICAgYWRkSW5wdXRFbGVtZW50TGlzdGVuZXIoKTtcbiAgICBhZGRSYW5kb21CdXR0b25MaXN0ZW5lcigpO1xuICAgIGFkZFRlbXBlcmF0dXJlQnV0dG9uTGlzdGVuZXJzKCk7XG4gIH07XG4gIHJldHVybiB7IGFkZFVzZXJJbnB1dExpc3RlbmVycyB9O1xufSkoKTtcblxuZXhwb3J0IHsgdXNlcklucHV0IH07XG4iLCJpbXBvcnQgeyBBUElSZXF1ZXN0IH0gZnJvbSBcIi4vQVBJX3JlcXVlc3RfbW9kdWxlXCI7XG5pbXBvcnQgeyB1c2VySW5wdXQgfSBmcm9tIFwiLi91c2VyX2lucHV0X21vZHVsZVwiO1xuaW1wb3J0IHsgRE9NTWFuaXB1bGF0aW9uIH0gZnJvbSBcIi4vRE9NX21hbmlwdWxhdGlvbl9tb2R1bGVcIjtcblxuKGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVQYWdlKCkge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQVBJUmVxdWVzdC5nZXRDaXR5V2VhdGhlcihcIkhlbGxcIik7XG4gICAgRE9NTWFuaXB1bGF0aW9uLnVwZGF0ZURpc3BsYXllZFdlYXRoZXIocmVzcG9uc2UpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIERPTU1hbmlwdWxhdGlvbi5hZGRQbGFjZWhvbGRlclZhbHVlcygpO1xuICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICBFcnJvcihcbiAgICAgICAgYCR7ZXJyb3Iuc3RhdHVzfSAke2Vycm9yLnN0YXR1c1RleHR9LiBJZiB5b3UgY2FuIHNlZSB0aGlzLCB0aGF0IG1lYW5zIHRoZXJlIHdhcyBhbiBpc3N1ZSB3aXRoIHRoZSBPcGVuV2VhdGhlck1hcCBBUEkhYFxuICAgICAgKVxuICAgICk7XG4gIH1cbn0pKCk7XG5cbnVzZXJJbnB1dC5hZGRVc2VySW5wdXRMaXN0ZW5lcnMoKTtcbiJdLCJuYW1lcyI6WyJBUElSZXF1ZXN0IiwiYXN5bmMiLCJjaXR5IiwicmVzcG9uc2UiLCJmZXRjaCIsInN0YXR1cyIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0IiwicmFuZG9tQ2l0eUluZGV4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibWV0aG9kIiwiaGVhZGVycyIsImZpbHRlckRhdGEiLCJnZXRUZW1wZXJhdHVyZSIsImRhdGEiLCJtYWluIiwidGVtcCIsImdldFRlbXBlcmF0dXJlRmFocmVuaGVpdCIsImZhaHJlbmhlaXQiLCJyb3VuZCIsImdldFRlbXBlcmF0dXJlQ2Vsc2l1cyIsImNlbHNpdXMiLCJnZXRXZWF0aGVyTWFpbiIsIndlYXRoZXIiLCJnZXRXZWF0aGVyRGVzY3JpcHRpb24iLCJkZXNjcmlwdGlvbiIsImdldFdlYXRoZXJJY29uQ29kZSIsImljb24iLCJnZXRDaXR5TmFtZSIsIm5hbWUiLCJnZXRSYW5kb21DaXR5TmFtZSIsImdldENvdW50cnlOYW1lIiwiY291bnRyeUNvZGUiLCJzeXMiLCJjb3VudHJ5IiwiZ2V0Q291bnRyeUNvZGUiLCJJbnRsIiwiRGlzcGxheU5hbWVzIiwidHlwZSIsIm9mIiwiRE9NTWFuaXB1bGF0aW9uIiwidGltZXIiLCJ0b2dnbGVFbGVtZW50RGlzcGxheSIsImVsZW1lbnQiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJjaGFuZ2VMb2FkaW5nTWVzc2FnZSIsIm1lc3NhZ2UiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsIndhaXRUaW1lciIsImR1cmF0aW9uIiwic2V0VGltZW91dCIsInVwZGF0ZURpc3BsYXllZFdlYXRoZXIiLCJ3ZWF0aGVyRGF0YSIsIndlYXRoZXJJY29uIiwic3JjIiwiYWRkV2VhdGhlckljb24iLCJ3ZWF0aGVyTWFpbiIsImFkZFdlYXRoZXJNYWluIiwid2VhdGhlckRlc2NyaXB0aW9uIiwiYWRkV2VhdGhlckRlc2NyaXB0aW9uIiwidGVtcEYiLCJhZGRUZW1wZXJhdHVyZUZhaHJlbmhlaXQiLCJ0ZW1wQyIsImFkZFRlbXBlcmF0dXJlQ2Vsc2l1cyIsImNpdHlOYW1lIiwiYWRkQ2l0eU5hbWUiLCJjb3VudHJ5TmFtZSIsImFkZENvdW50cnlOYW1lIiwidmFsdWUiLCJhZGRQbGFjZWhvbGRlclZhbHVlcyIsIndlYXRoZXJJY29uRWxlbWVudCIsIndlYXRoZXJNYWluRWxlbWVudCIsIndlYXRoZXJEZXNjcmlwdGlvbkVsZW1lbnQiLCJ0ZW1wRkVsZW1lbnQiLCJ0ZW1wQ0VsZW1lbnQiLCJjaXR5TmFtZUVsZW1lbnQiLCJjaGFuZ2VFcnJvck1lc3NhZ2UiLCJ0b2dnbGVMb2FkaW5nSW5Qcm9ncmVzcyIsImxvYWRpbmdNZXNzYWdlIiwibG9hZGluZ0luZGljYXRvciIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZGlzYWJsZWQiLCJpbmNsdWRlcyIsInRvZ2dsZUxvYWRpbmdNZXNzYWdlQ3ljbGUiLCJyZXNldEVycm9yIiwiZXJyb3JNZXNzYWdlRWxlbWVudCIsImFkZCIsInVzZXJJbnB1dCIsInN1Ym1pdFVzZXJJbnB1dCIsImNpdHlJbnB1dFZhbHVlIiwiZXJyb3IiLCJjb25zb2xlIiwiRXJyb3IiLCJzdGF0dXNUZXh0Iiwic3VibWl0UmFuZG9tSW5wdXQiLCJyYW5kb21DaXR5TmFtZSIsIndlYXRoZXJSZXNwb25zZSIsImNpdHlSZXNwb25zZSIsInVuZGVmaW5lZCIsImFkZFVzZXJJbnB1dExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleSIsInRlbXBCdXR0b25zIiwiYnV0dG9uIiwiYWRkVGVtcGVyYXR1cmVCdXR0b25MaXN0ZW5lcnMiXSwic291cmNlUm9vdCI6IiJ9